

<!DOCTYPE html>
<html class="writer-html4" lang="ko" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>dpmModule.kernel.core &mdash; DpmModule  documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/translations.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="색인" href="../../../genindex.html" />
    <link rel="search" title="검색" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> DpmModule
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">설치</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../GraphElement.html">GraphElement</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">DpmModule</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">모듈 코드</a> &raquo;</li>
        
      <li>dpmModule.kernel.core</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for dpmModule.kernel.core</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">.graph</span> <span class="k">import</span> <span class="n">EvaluativeGraphElement</span><span class="p">,</span> <span class="n">DynamicVariableOperation</span><span class="p">,</span> <span class="n">DynamicVariableInstance</span><span class="p">,</span> <span class="n">AbstractDynamicVariableInstance</span>
<span class="kn">from</span> <span class="nn">.abstract</span> <span class="k">import</span> <span class="n">AbstractScenarioGraph</span><span class="p">,</span> <span class="n">AbstractVEnhancer</span><span class="p">,</span> <span class="n">AbstractVBuilder</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">defaultdict</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="n">NOTWANTTOEXECUTE</span> <span class="o">=</span> <span class="mi">99999999</span>
<span class="n">MAX_DAMAGE_RESTRICTION</span> <span class="o">=</span> <span class="mi">10000</span> <span class="o">*</span> <span class="mi">10000</span> <span class="o">*</span> <span class="mi">100</span>

<span class="k">def</span> <span class="nf">infinite_time</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">NOTWANTTOEXECUTE</span>

<span class="k">class</span> <span class="nc">CharacterModifier</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="s1">&#39;crit&#39;</span><span class="p">,</span> <span class="s1">&#39;crit_damage&#39;</span><span class="p">,</span> <span class="s1">&#39;pdamage&#39;</span><span class="p">,</span> <span class="s1">&#39;pdamage_indep&#39;</span><span class="p">,</span> <span class="s1">&#39;stat_main&#39;</span><span class="p">,</span> <span class="s1">&#39;stat_sub&#39;</span><span class="p">,</span> <span class="s1">&#39;pstat_main&#39;</span><span class="p">,</span> <span class="s1">&#39;pstat_sub&#39;</span><span class="p">,</span> <span class="s1">&#39;boss_pdamage&#39;</span><span class="p">,</span> <span class="s1">&#39;armor_ignore&#39;</span><span class="p">,</span> <span class="s1">&#39;patt&#39;</span><span class="p">,</span> <span class="s1">&#39;att&#39;</span><span class="p">,</span> <span class="s1">&#39;stat_main_fixed&#39;</span><span class="p">,</span> <span class="s1">&#39;stat_sub_fixed&#39;</span>
    <span class="sd">&#39;&#39;&#39;CharacterModifier : Holds information about character modifiing factors ex ) pdamage, stat, att%, etc.AbstractSkill</span>
<span class="sd">    - parameters</span>
<span class="sd">      </span>
<span class="sd">      .crit : Additional critical value</span>
<span class="sd">      .crit_damage : Critical damage increment %</span>
<span class="sd">      </span>
<span class="sd">      .pdamage : Damage increment %</span>
<span class="sd">      .pdamage_indep : Total Damage Increment %.</span>
<span class="sd">      </span>
<span class="sd">      .stat_main : Main stat increment</span>
<span class="sd">      .stat_sub : Sub stat increment</span>
<span class="sd">      </span>
<span class="sd">      .stat_main : Main stat increment %</span>
<span class="sd">      .stat_sub : Sub stat increment %</span>
<span class="sd">      </span>
<span class="sd">      .boss_pdamage : Boss Attack Damage increment%</span>
<span class="sd">      .armor_ignore : Armor Ignorance %</span>
<span class="sd">      </span>
<span class="sd">      .att : AD increment</span>
<span class="sd">      .patt : AD increment %</span>
<span class="sd">      </span>
<span class="sd">      * Additional parameters can be involved with inherit this class.  </span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">crit</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">crit_damage</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pdamage</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pdamage_indep</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">stat_main</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">stat_sub</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pstat_main</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pstat_sub</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">boss_pdamage</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">armor_ignore</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">patt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">att</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">stat_main_fixed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">stat_sub_fixed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crit</span> <span class="o">=</span> <span class="n">crit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crit_damage</span> <span class="o">=</span> <span class="n">crit_damage</span>        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">pdamage</span> <span class="o">=</span> <span class="n">pdamage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdamage_indep</span> <span class="o">=</span> <span class="n">pdamage_indep</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">stat_main</span> <span class="o">=</span> <span class="n">stat_main</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stat_sub</span> <span class="o">=</span> <span class="n">stat_sub</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">pstat_sub</span> <span class="o">=</span> <span class="n">pstat_sub</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pstat_main</span> <span class="o">=</span> <span class="n">pstat_main</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">boss_pdamage</span> <span class="o">=</span> <span class="n">boss_pdamage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">armor_ignore</span> <span class="o">=</span> <span class="n">armor_ignore</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">att</span> <span class="o">=</span> <span class="n">att</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patt</span> <span class="o">=</span> <span class="n">patt</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">stat_main_fixed</span> <span class="o">=</span> <span class="n">stat_main_fixed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stat_sub_fixed</span> <span class="o">=</span> <span class="n">stat_sub_fixed</span>

    <span class="k">def</span> <span class="nf">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crit</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">.</span><span class="n">crit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crit_damage</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">.</span><span class="n">crit_damage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdamage</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">.</span><span class="n">pdamage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdamage_indep</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">.</span><span class="n">pdamage_indep</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdamage_indep</span> <span class="o">*</span> <span class="n">arg</span><span class="o">.</span><span class="n">pdamage_indep</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.01</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stat_main</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">.</span><span class="n">stat_main</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stat_sub</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">.</span><span class="n">stat_sub</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pstat_main</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">.</span><span class="n">pstat_main</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pstat_sub</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">.</span><span class="n">pstat_sub</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boss_pdamage</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">.</span><span class="n">boss_pdamage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">armor_ignore</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">-</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="p">((</span><span class="mi">100</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">armor_ignore</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">100</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">armor_ignore</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patt</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">.</span><span class="n">patt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">att</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">.</span><span class="n">att</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">stat_main_fixed</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">.</span><span class="n">stat_main_fixed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stat_sub_fixed</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">.</span><span class="n">stat_sub_fixed</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">CharacterModifier</span><span class="p">(</span><span class="n">crit</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crit</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">crit</span><span class="p">),</span> \
                        <span class="n">crit_damage</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crit_damage</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">crit_damage</span><span class="p">)</span> <span class="p">,</span> \
                        <span class="n">pdamage</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdamage</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">pdamage</span><span class="p">),</span> \
                        <span class="n">pdamage_indep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdamage_indep</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">pdamage_indep</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdamage_indep</span> <span class="o">*</span> <span class="n">arg</span><span class="o">.</span><span class="n">pdamage_indep</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.01</span><span class="p">,</span> \
                        <span class="n">stat_main</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_main</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">stat_main</span><span class="p">),</span>\
                        <span class="n">stat_sub</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_sub</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">stat_sub</span><span class="p">),</span> \
                        <span class="n">pstat_main</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pstat_main</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">pstat_main</span><span class="p">),</span> \
                        <span class="n">pstat_sub</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pstat_sub</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">pstat_sub</span><span class="p">),</span> \
                        <span class="n">boss_pdamage</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boss_pdamage</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">boss_pdamage</span><span class="p">),</span>\
                        <span class="n">armor_ignore</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">-</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="p">((</span><span class="mi">100</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">armor_ignore</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">100</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">armor_ignore</span><span class="p">)),</span> \
                        <span class="n">patt</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patt</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">patt</span><span class="p">),</span> \
                        <span class="n">att</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">att</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">att</span><span class="p">),</span> \
                        <span class="n">stat_main_fixed</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_main_fixed</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">stat_main_fixed</span><span class="p">),</span> \
                        <span class="n">stat_sub_fixed</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_sub_fixed</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">stat_sub_fixed</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">CharacterModifier</span><span class="p">(</span><span class="n">crit</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crit</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">crit</span><span class="p">),</span>   \
                        <span class="n">crit_damage</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crit_damage</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">crit_damage</span><span class="p">)</span> <span class="p">,</span> \
                        <span class="n">pdamage</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdamage</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">pdamage</span><span class="p">),</span> \
                        <span class="n">pdamage_indep</span> <span class="o">=</span> <span class="p">(</span><span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdamage_indep</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">100</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">pdamage_indep</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">-</span> <span class="mi">100</span><span class="p">,</span> \
                        <span class="n">stat_main</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_main</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">stat_main</span><span class="p">),</span>\
                        <span class="n">stat_sub</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_sub</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">stat_sub</span><span class="p">),</span> \
                        <span class="n">pstat_main</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pstat_main</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">pstat_main</span><span class="p">),</span> \
                        <span class="n">pstat_sub</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pstat_sub</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">pstat_sub</span><span class="p">),</span> \
                        <span class="n">boss_pdamage</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boss_pdamage</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">boss_pdamage</span><span class="p">),</span>\
                        <span class="n">armor_ignore</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">-</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="mi">100</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">armor_ignore</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">100</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">armor_ignore</span><span class="p">),</span> \
                        <span class="n">patt</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patt</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">patt</span><span class="p">),</span> \
                        <span class="n">att</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">att</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">att</span><span class="p">),</span> \
                        <span class="n">stat_main_fixed</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_main_fixed</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">stat_main_fixed</span><span class="p">),</span> \
                        <span class="n">stat_sub_fixed</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_sub_fixed</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">stat_sub_fixed</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">CharacterModifier</span><span class="p">(</span><span class="n">crit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crit</span><span class="p">,</span> <span class="n">crit_damage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crit_damage</span><span class="p">,</span> <span class="n">pdamage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdamage</span><span class="p">,</span> 
                    <span class="n">pdamage_indep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdamage_indep</span><span class="p">,</span> <span class="n">stat_main</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_main</span><span class="p">,</span> <span class="n">stat_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_sub</span><span class="p">,</span> 
                    <span class="n">pstat_main</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pstat_main</span><span class="p">,</span> <span class="n">pstat_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pstat_sub</span><span class="p">,</span> <span class="n">boss_pdamage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boss_pdamage</span><span class="p">,</span> 
                    <span class="n">armor_ignore</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">armor_ignore</span><span class="p">,</span> <span class="n">patt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patt</span><span class="p">,</span> <span class="n">att</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span><span class="p">,</span> <span class="n">stat_main_fixed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_main_fixed</span><span class="p">,</span> <span class="n">stat_sub_fixed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_sub_fixed</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ExtendedCharacterModifier</span><span class="p">(</span><span class="n">crit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crit</span><span class="p">,</span> <span class="n">crit_damage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crit_damage</span><span class="p">,</span> <span class="n">pdamage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdamage</span><span class="p">,</span> 
                    <span class="n">pdamage_indep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdamage_indep</span><span class="p">,</span> <span class="n">stat_main</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_main</span><span class="p">,</span> <span class="n">stat_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_sub</span><span class="p">,</span> 
                    <span class="n">pstat_main</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pstat_main</span><span class="p">,</span> <span class="n">pstat_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pstat_sub</span><span class="p">,</span> <span class="n">boss_pdamage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boss_pdamage</span><span class="p">,</span> 
                    <span class="n">armor_ignore</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">armor_ignore</span><span class="p">,</span> <span class="n">patt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patt</span><span class="p">,</span> <span class="n">att</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span><span class="p">,</span> <span class="n">stat_main_fixed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_main_fixed</span><span class="p">,</span> <span class="n">stat_sub_fixed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_sub_fixed</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">get_damage_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">armor</span> <span class="o">=</span> <span class="mi">300</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Caution : Use this function only if you summed up every modifiers.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">real_crit</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">crit</span><span class="p">)</span>
        <span class="n">stat</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_main</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pstat_main</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_sub</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pstat_sub</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_main_fixed</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_sub_fixed</span> <span class="p">)</span>
        <span class="n">adap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">patt</span><span class="p">)</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.0001</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">real_crit</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crit_damage</span> <span class="o">+</span> <span class="mi">35</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdamage</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">boss_pdamage</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdamage_indep</span><span class="p">)</span>
        <span class="n">ignorance</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="mi">100</span> <span class="o">-</span> <span class="n">armor</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mf">0.01</span><span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">armor_ignore</span><span class="p">))</span> <span class="o">*</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stat</span> <span class="o">*</span> <span class="n">adap</span> <span class="o">*</span> <span class="n">factor</span> <span class="o">*</span> <span class="n">ignorance</span> <span class="o">*</span> <span class="mf">0.01</span>

    <span class="k">def</span> <span class="nf">get_status_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">armor</span> <span class="o">=</span> <span class="mi">300</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Caution : Use this function only if you summed up every modifiers.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">stat</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_main</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pstat_main</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_sub</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pstat_sub</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_main_fixed</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_sub_fixed</span> <span class="p">)</span>
        <span class="n">adap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">patt</span><span class="p">)</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdamage</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdamage_indep</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stat</span> <span class="o">*</span> <span class="n">adap</span> <span class="o">*</span> <span class="n">factor</span> <span class="o">*</span> <span class="mf">0.01</span>
    
    <span class="k">def</span> <span class="nf">calculate_damage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">damage</span><span class="p">,</span> <span class="n">hit</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">armor</span> <span class="o">=</span> <span class="mi">300</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return : (damage, loss) tuple</span>
<span class="sd">        숙련도는 90~100으로 가정함(5% deviation)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">def</span> <span class="nf">restricted_damage</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">M</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;Calculated expected value of min(M, xy) in [x1~x2, y1~y2]</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="n">normalizer</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span>
            <span class="n">basis</span> <span class="o">=</span> <span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">x2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">y1</span> <span class="o">+</span> <span class="n">y2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            
            <span class="k">if</span> <span class="n">M</span> <span class="o">&gt;</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">y2</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">basis</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">M</span> <span class="o">&gt;</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">y2</span> <span class="ow">and</span> <span class="n">M</span> <span class="o">&gt;</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">y1</span><span class="p">:</span>
                    <span class="n">x_p</span> <span class="o">=</span> <span class="n">M</span> <span class="o">/</span> <span class="n">y2</span>
                    <span class="c1"># Case 1</span>
                    <span class="n">excess</span> <span class="o">=</span> <span class="n">M</span> <span class="o">*</span> <span class="n">y2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x_p</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">y2</span> <span class="o">*</span> <span class="n">y2</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span><span class="p">(</span><span class="n">x2</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x_p</span> <span class="o">*</span> <span class="n">x_p</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">M</span> <span class="o">*</span> <span class="n">M</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x2</span> <span class="o">/</span> <span class="n">x_p</span><span class="p">)</span>
                    
                    <span class="k">return</span> <span class="n">basis</span> <span class="o">+</span> <span class="n">excess</span> <span class="o">/</span> <span class="n">normalizer</span>
                <span class="k">elif</span> <span class="n">M</span> <span class="o">&lt;</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">y2</span> <span class="ow">and</span> <span class="n">M</span> <span class="o">&gt;</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">y1</span><span class="p">:</span>
                    <span class="c1"># Case 2</span>
                    <span class="n">x_p</span> <span class="o">=</span> <span class="n">x1</span>
                    <span class="c1"># Case 1</span>
                    <span class="n">excess</span> <span class="o">=</span> <span class="n">M</span> <span class="o">*</span> <span class="n">y2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x_p</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">y2</span> <span class="o">*</span> <span class="n">y2</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span><span class="p">(</span><span class="n">x2</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x_p</span> <span class="o">*</span> <span class="n">x_p</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">M</span> <span class="o">*</span> <span class="n">M</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x2</span> <span class="o">/</span> <span class="n">x_p</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">basis</span> <span class="o">+</span> <span class="n">excess</span> <span class="o">/</span> <span class="n">normalizer</span>

                <span class="k">elif</span> <span class="n">M</span> <span class="o">&gt;</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">y2</span> <span class="ow">and</span> <span class="n">M</span> <span class="o">&lt;</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">y1</span><span class="p">:</span>
                    <span class="c1"># Case 3 -&gt; change to Case 2</span>
                    <span class="k">return</span> <span class="n">restricted_damage</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
                    
                <span class="k">elif</span> <span class="n">M</span> <span class="o">&gt;</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">y1</span><span class="p">:</span>
                    <span class="n">x_p</span> <span class="o">=</span> <span class="n">M</span> <span class="o">/</span> <span class="n">y1</span>
                    <span class="n">excess</span> <span class="o">=</span> <span class="n">M</span> <span class="o">*</span> <span class="n">y1</span> <span class="o">*</span> <span class="p">(</span><span class="n">x_p</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">y1</span> <span class="o">*</span> <span class="n">y1</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x_p</span> <span class="o">*</span> <span class="n">x_p</span> <span class="o">-</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">M</span> <span class="o">*</span> <span class="n">M</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x_p</span> <span class="o">/</span> <span class="n">x1</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">M</span> <span class="o">+</span> <span class="n">excess</span> <span class="o">/</span> <span class="n">normalizer</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">M</span>

        <span class="c1">#Optimized</span>
        <span class="n">real_crit</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">crit</span><span class="p">)</span>
        <span class="n">stat</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_main</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pstat_main</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_sub</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pstat_sub</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_main_fixed</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_sub_fixed</span> <span class="p">)</span>
        <span class="n">adap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">patt</span><span class="p">)</span>
        <span class="n">factor_crit_removed</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdamage</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">boss_pdamage</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdamage_indep</span><span class="p">)</span>
        <span class="n">ignorance</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="mi">100</span> <span class="o">-</span> <span class="n">armor</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mf">0.01</span><span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">armor_ignore</span><span class="p">))</span> <span class="o">*</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">expert_max</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">/</span> <span class="mi">95</span>
        <span class="n">expert_min</span> <span class="o">=</span> <span class="mi">90</span> <span class="o">/</span> <span class="mi">95</span>

        <span class="k">if</span> <span class="n">spec</span> <span class="o">==</span> <span class="s2">&quot;dot&quot;</span><span class="p">:</span>
            <span class="n">real_crit</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">factor_crit_removed</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">ignorance</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">expert_min</span> <span class="o">=</span> <span class="n">expert_max</span>
        
        <span class="n">factor_aggregated</span> <span class="o">=</span> <span class="n">stat</span> <span class="o">*</span> <span class="n">adap</span> <span class="o">*</span> <span class="n">factor_crit_removed</span> <span class="o">*</span> <span class="n">ignorance</span> <span class="o">*</span> <span class="n">damage</span> <span class="o">*</span> <span class="mf">0.0001</span>
        
        <span class="n">max_crit_factor</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.0001</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">real_crit</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crit_damage</span> <span class="o">+</span> <span class="mi">50</span><span class="p">))</span>
        <span class="n">min_crit_factor</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.0001</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">real_crit</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crit_damage</span> <span class="o">+</span> <span class="mi">20</span><span class="p">))</span>
        
        <span class="n">max_damage_factor</span> <span class="o">=</span> <span class="n">factor_aggregated</span> <span class="o">*</span> <span class="n">expert_max</span>
        <span class="n">min_damage_factor</span> <span class="o">=</span> <span class="n">factor_aggregated</span> <span class="o">*</span> <span class="n">expert_min</span>

        <span class="n">real_damage</span> <span class="o">=</span> <span class="n">hit</span> <span class="o">*</span> <span class="p">(</span><span class="n">max_crit_factor</span> <span class="o">+</span> <span class="n">min_crit_factor</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">max_damage_factor</span> <span class="o">+</span> <span class="n">min_damage_factor</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="c1"># W/O restriction</span>
        <span class="n">res_damage</span> <span class="o">=</span> <span class="n">hit</span> <span class="o">*</span> <span class="n">restricted_damage</span><span class="p">(</span><span class="n">min_damage_factor</span><span class="p">,</span> <span class="n">max_damage_factor</span><span class="p">,</span> <span class="n">min_crit_factor</span><span class="p">,</span> <span class="n">max_crit_factor</span><span class="p">,</span> <span class="n">MAX_DAMAGE_RESTRICTION</span><span class="p">)</span>  <span class="c1"># W/ restriction</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">res_damage</span><span class="p">,</span> <span class="n">real_damage</span> <span class="o">-</span> <span class="n">res_damage</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;crit rate : </span><span class="si">%.1f</span><span class="s2">, crit damage : </span><span class="si">%.1f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">crit_damage</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s2">&quot;pdamage : </span><span class="si">%.1f</span><span class="s2">, pdamage_indep : </span><span class="si">%.1f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdamage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdamage_indep</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s2">&quot;stat_main : </span><span class="si">%.1f</span><span class="s2">, stat_sub : </span><span class="si">%.1f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_main</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_sub</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s2">&quot;pstat_main : </span><span class="si">%.1f</span><span class="s2">, pstat_sub : </span><span class="si">%.1f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pstat_main</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pstat_sub</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s2">&quot;stat_main_fixed : </span><span class="si">%.1f</span><span class="s2">, stat_sub_fixed : </span><span class="si">%.1f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_main_fixed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_sub_fixed</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s2">&quot;boss_pdamage : </span><span class="si">%.1f</span><span class="s2">, armor_ignore : </span><span class="si">%.1f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boss_pdamage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">armor_ignore</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s2">&quot;att : </span><span class="si">%.1f</span><span class="s2">, patt : </span><span class="si">%.1f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">att</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">patt</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s2">&quot;damageFactor : </span><span class="si">%.1f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_damage_factor</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">txt</span>
    
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">abstract_log_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lang</span> <span class="o">=</span> <span class="s2">&quot;ko&quot;</span><span class="p">):</span>
        <span class="n">crit_rate_formal</span> <span class="o">=</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crit</span><span class="o">*</span><span class="mi">10</span><span class="p">))</span><span class="o">/</span><span class="mi">10</span>
        <span class="k">if</span> <span class="n">crit_rate_formal</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">:</span>
            <span class="n">crit_rate_formal</span> <span class="o">=</span> <span class="s2">&quot;미발동&quot;</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s2">&quot;ko&quot;</span><span class="p">:</span>
            <span class="n">el</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;크리티컬 확률&quot;</span><span class="p">,</span> <span class="n">crit_rate_formal</span><span class="p">,</span> <span class="s2">&quot;%&quot;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s2">&quot;크리티컬 데미지&quot;</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crit_damage</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span><span class="s2">&quot;%&quot;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s2">&quot;주스텟&quot;</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_main</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">),</span>
                        <span class="p">(</span><span class="s2">&quot;부스텟&quot;</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_sub</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">),</span>
                        <span class="p">(</span><span class="s2">&quot;총 데미지&quot;</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdamage</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span><span class="s2">&quot;%&quot;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s2">&quot;보스 공격력&quot;</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span> <span class="n">boss_pdamage</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span><span class="s2">&quot;%&quot;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s2">&quot;주스텟퍼&quot;</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pstat_main</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span><span class="s2">&quot;%&quot;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s2">&quot;부스텟퍼&quot;</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pstat_sub</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span><span class="s2">&quot;%&quot;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s2">&quot;최종뎀&quot;</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdamage_indep</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span><span class="s2">&quot;%&quot;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s2">&quot;공격력&quot;</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">att</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">),</span>
                        <span class="p">(</span><span class="s2">&quot;공퍼&quot;</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patt</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span><span class="s2">&quot;%&quot;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s2">&quot;방무&quot;</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">armor_ignore</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span><span class="s2">&quot;%&quot;</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">lang</span> <span class="o">==</span> <span class="s2">&quot;en&quot;</span><span class="p">:</span>
            <span class="n">el</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;crit rate&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">crit</span><span class="p">),</span>
                        <span class="p">(</span><span class="s2">&quot;crit damage&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">crit_damage</span><span class="p">),</span>
                        <span class="p">(</span><span class="s2">&quot;main stat&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_main</span><span class="p">),</span>
                        <span class="p">(</span><span class="s2">&quot;sub stat&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_sub</span><span class="p">),</span>
                        <span class="p">(</span><span class="s2">&quot;total damageP&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdamage</span><span class="p">),</span>
                        <span class="p">(</span><span class="s2">&quot;boss damageP&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span> <span class="n">boss_pdamage</span><span class="p">),</span>
                        <span class="p">(</span><span class="s2">&quot;main statP&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pstat_main</span><span class="p">),</span>
                        <span class="p">(</span><span class="s2">&quot;sub statP&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pstat_sub</span><span class="p">),</span>
                        <span class="p">(</span><span class="s2">&quot;final damageP&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdamage_indep</span><span class="p">),</span>
                        <span class="p">(</span><span class="s2">&quot;AD/MD&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span><span class="p">),</span>
                        <span class="p">(</span><span class="s2">&quot;AD/MD P&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">patt</span><span class="p">),</span>
                        <span class="p">(</span><span class="s2">&quot;armor ignorance&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">armor_ignore</span><span class="p">)]</span>
        <span class="n">retel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">el</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="n">retel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">retel</span>
    
    <span class="k">def</span> <span class="nf">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;crit&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">crit</span><span class="p">,</span>
                <span class="s2">&quot;crit_damage&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">crit_damage</span><span class="p">,</span>
                <span class="s2">&quot;pdamage&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdamage</span><span class="p">,</span>
                <span class="s2">&quot;pdamage_indep&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdamage_indep</span><span class="p">,</span>
                <span class="s2">&quot;stat_main&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_main</span><span class="p">,</span>
                <span class="s2">&quot;stat_sub&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_sub</span><span class="p">,</span>
                <span class="s2">&quot;pstat_main&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">pstat_main</span><span class="p">,</span>
                <span class="s2">&quot;pstat_sub&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pstat_sub</span><span class="p">,</span>
                <span class="s2">&quot;boss_pdamage&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">boss_pdamage</span><span class="p">,</span>
                <span class="s2">&quot;armor_ignore&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">armor_ignore</span><span class="p">,</span>
                <span class="s2">&quot;patt&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">patt</span><span class="p">,</span>
                <span class="s2">&quot;att&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">att</span><span class="p">,</span>
                <span class="s2">&quot;stat_main_fixed&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_main_fixed</span><span class="p">,</span>
                <span class="s2">&quot;stat_sub_fixed&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_sub_fixed</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">_dynamic_variable_hint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">character_modifier</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">character_modifier</span><span class="p">,</span> <span class="n">DynamicCharacterModifier</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">DynamicCharacterModifier</span><span class="p">(</span><span class="n">crit</span> <span class="o">=</span> <span class="n">character_modifier</span><span class="o">.</span><span class="n">crit</span><span class="p">,</span> <span class="n">crit_damage</span> <span class="o">=</span> <span class="n">character_modifier</span><span class="o">.</span><span class="n">crit_damage</span><span class="p">,</span> <span class="n">pdamage</span> <span class="o">=</span> <span class="n">character_modifier</span><span class="o">.</span><span class="n">pdamage</span><span class="p">,</span> 
                    <span class="n">pdamage_indep</span> <span class="o">=</span> <span class="n">character_modifier</span><span class="o">.</span><span class="n">pdamage_indep</span><span class="p">,</span> <span class="n">stat_main</span> <span class="o">=</span> <span class="n">character_modifier</span><span class="o">.</span><span class="n">stat_main</span><span class="p">,</span> <span class="n">stat_sub</span> <span class="o">=</span> <span class="n">character_modifier</span><span class="o">.</span><span class="n">stat_sub</span><span class="p">,</span> 
                    <span class="n">pstat_main</span> <span class="o">=</span> <span class="n">character_modifier</span><span class="o">.</span><span class="n">pstat_main</span><span class="p">,</span> <span class="n">pstat_sub</span> <span class="o">=</span> <span class="n">character_modifier</span><span class="o">.</span><span class="n">pstat_sub</span><span class="p">,</span> <span class="n">boss_pdamage</span> <span class="o">=</span> <span class="n">character_modifier</span><span class="o">.</span><span class="n">boss_pdamage</span><span class="p">,</span> 
                    <span class="n">armor_ignore</span> <span class="o">=</span> <span class="n">character_modifier</span><span class="o">.</span><span class="n">armor_ignore</span><span class="p">,</span> <span class="n">patt</span> <span class="o">=</span> <span class="n">character_modifier</span><span class="o">.</span><span class="n">patt</span><span class="p">,</span> <span class="n">att</span> <span class="o">=</span> <span class="n">character_modifier</span><span class="o">.</span><span class="n">att</span><span class="p">,</span> <span class="n">stat_main_fixed</span> <span class="o">=</span> <span class="n">character_modifier</span><span class="o">.</span><span class="n">stat_main_fixed</span><span class="p">,</span> <span class="n">stat_sub_fixed</span> <span class="o">=</span> <span class="n">character_modifier</span><span class="o">.</span><span class="n">stat_sub_fixed</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

<span class="k">class</span> <span class="nc">DynamicCharacterModifier</span><span class="p">(</span><span class="n">DynamicVariableInstance</span><span class="p">,</span> <span class="n">CharacterModifier</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">DynamicVariableInstance</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>        
        <span class="n">parsed_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span> <span class="p">:</span> <span class="n">DynamicVariableOperation</span><span class="o">.</span><span class="n">wrap_argument</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">parsed_kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_next_instance</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="n">a</span><span class="o">.</span><span class="n">inherit_namespace</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">CharacterModifier</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">parsed_kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">evaluate_override</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">CharacterModifier</span><span class="p">(</span><span class="n">crit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crit</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(),</span>
                    <span class="n">crit_damage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crit_damage</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(),</span> <span class="n">pdamage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdamage</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(),</span> 
                    <span class="n">pdamage_indep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdamage_indep</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(),</span> <span class="n">stat_main</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_main</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(),</span>
                    <span class="n">stat_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_sub</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(),</span> 
                    <span class="n">pstat_main</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pstat_main</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(),</span> <span class="n">pstat_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pstat_sub</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(),</span> 
                    <span class="n">boss_pdamage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boss_pdamage</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(),</span> 
                    <span class="n">armor_ignore</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">armor_ignore</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(),</span> 
                    <span class="n">patt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patt</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(),</span> 
                    <span class="n">att</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(),</span> <span class="n">stat_main_fixed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_main_fixed</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(),</span> 
                    <span class="n">stat_sub_fixed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_sub_fixed</span><span class="o">.</span><span class="n">evaluate</span><span class="p">())</span>

<span class="k">class</span> <span class="nc">SkillModifier</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buff_rem</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">summon_rem</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cooltime_reduce</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pcooltime_reduce</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">reuse_chance</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buff_rem</span> <span class="o">=</span> <span class="n">buff_rem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">summon_rem</span> <span class="o">=</span> <span class="n">summon_rem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cooltime_reduce</span> <span class="o">=</span> <span class="n">cooltime_reduce</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pcooltime_reduce</span> <span class="o">=</span> <span class="n">pcooltime_reduce</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reuse_chance</span> <span class="o">=</span> <span class="n">reuse_chance</span>
    
    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">SkillModifier</span><span class="p">(</span><span class="n">buff_rem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buff_rem</span><span class="p">,</span> <span class="n">summon_rem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">summon_rem</span><span class="p">,</span> <span class="n">cooltime_reduce</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cooltime_reduce</span><span class="p">,</span>
            <span class="n">pcooltime_reduce</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pcooltime_reduce</span><span class="p">,</span> <span class="n">reuse_chance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reuse_chance</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">SkillModifier</span><span class="p">(</span>
            <span class="n">buff_rem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buff_rem</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">buff_rem</span><span class="p">,</span>
            <span class="n">summon_rem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">summon_rem</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">summon_rem</span><span class="p">,</span>
            <span class="n">cooltime_reduce</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cooltime_reduce</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">cooltime_reduce</span><span class="p">,</span>
            <span class="n">pcooltime_reduce</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pcooltime_reduce</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">pcooltime_reduce</span><span class="p">,</span>
            <span class="n">reuse_chance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reuse_chance</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">reuse_chance</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ExtendedCharacterModifier</span><span class="p">(</span><span class="n">CharacterModifier</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buff_rem</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">summon_rem</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cooltime_reduce</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pcooltime_reduce</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">reuse_chance</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">prop_ignore</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">additional_target</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">passive_level</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ExtendedCharacterModifier</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buff_rem</span> <span class="o">=</span> <span class="n">buff_rem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">summon_rem</span> <span class="o">=</span> <span class="n">summon_rem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cooltime_reduce</span> <span class="o">=</span> <span class="n">cooltime_reduce</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pcooltime_reduce</span> <span class="o">=</span> <span class="n">pcooltime_reduce</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reuse_chance</span> <span class="o">=</span> <span class="n">reuse_chance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prop_ignore</span> <span class="o">=</span> <span class="n">prop_ignore</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">additional_target</span> <span class="o">=</span> <span class="n">additional_target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">passive_level</span> <span class="o">=</span> <span class="n">passive_level</span>

    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ExtendedCharacterModifier</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">log</span><span class="p">()</span>
        <span class="n">txt</span> <span class="o">+</span> <span class="s2">&quot;buff_rem : </span><span class="si">%.1f</span><span class="s2">, summon_rem : </span><span class="si">%.1f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buff_rem</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">summon_rem</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s2">&quot;cooltime_reduce : </span><span class="si">%.1f</span><span class="s2"> pcooltime_reduce : </span><span class="si">%.1f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cooltime_reduce</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pcooltime_reduce</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s2">&quot;reuse_chance : </span><span class="si">%.1f</span><span class="s2"> prop_ignore : </span><span class="si">%.1f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reuse_chance</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop_ignore</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s2">&quot;additional_target : </span><span class="si">%d</span><span class="s2"> passive_level : </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">additional_target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">passive_level</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">txt</span>
    
    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ExtendedCharacterModifier</span><span class="p">(</span>
            <span class="n">buff_rem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buff_rem</span><span class="p">,</span> <span class="n">summon_rem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">summon_rem</span><span class="p">,</span> <span class="n">cooltime_reduce</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cooltime_reduce</span><span class="p">,</span> <span class="n">pcooltime_reduce</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pcooltime_reduce</span><span class="p">,</span>
            <span class="n">reuse_chance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reuse_chance</span><span class="p">,</span> <span class="n">prop_ignore</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop_ignore</span><span class="p">,</span> <span class="n">additional_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">additional_target</span><span class="p">,</span> <span class="n">passive_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passive_level</span><span class="p">,</span>
            <span class="n">crit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crit</span><span class="p">,</span> <span class="n">crit_damage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crit_damage</span><span class="p">,</span> <span class="n">pdamage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdamage</span><span class="p">,</span> 
            <span class="n">pdamage_indep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdamage_indep</span><span class="p">,</span> <span class="n">stat_main</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_main</span><span class="p">,</span> <span class="n">stat_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_sub</span><span class="p">,</span> 
            <span class="n">pstat_main</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pstat_main</span><span class="p">,</span> <span class="n">pstat_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pstat_sub</span><span class="p">,</span> <span class="n">boss_pdamage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boss_pdamage</span><span class="p">,</span> 
            <span class="n">armor_ignore</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">armor_ignore</span><span class="p">,</span> <span class="n">patt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patt</span><span class="p">,</span> <span class="n">att</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">att</span><span class="p">,</span> <span class="n">stat_main_fixed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_main_fixed</span><span class="p">,</span> <span class="n">stat_sub_fixed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_sub_fixed</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">degenerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">ExtendedCharacterModifier</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">to_skill_modifier</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">SkillModifier</span><span class="p">(</span><span class="n">buff_rem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buff_rem</span><span class="p">,</span> <span class="n">summon_rem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">summon_rem</span><span class="p">,</span>
            <span class="n">cooltime_reduce</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cooltime_reduce</span><span class="p">,</span> <span class="n">pcooltime_reduce</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pcooltime_reduce</span><span class="p">,</span> <span class="n">reuse_chance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reuse_chance</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ret_dict</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ExtendedCharacterModifier</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="o">**</span><span class="n">ret_dict</span><span class="p">,</span>
            <span class="s2">&quot;buff_rem&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">buff_rem</span><span class="p">,</span>
            <span class="s2">&quot;summon_rem&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">summon_rem</span><span class="p">,</span>
            <span class="s2">&quot;cooltime_reduce&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cooltime_reduce</span><span class="p">,</span>
            <span class="s2">&quot;pcooltime_reduce&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pcooltime_reduce</span><span class="p">,</span>
            <span class="s2">&quot;reuse_chance&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">reuse_chance</span><span class="p">,</span>
            <span class="s2">&quot;prop_ignore&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop_ignore</span><span class="p">,</span>
            <span class="s2">&quot;additional_target&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">additional_target</span><span class="p">,</span>
            <span class="s2">&quot;passive_level&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">passive_level</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buff_rem</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">.</span><span class="n">buff_rem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">summon_rem</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">.</span><span class="n">summon_rem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cooltime_reduce</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">.</span><span class="n">cooltime_reduce</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pcooltime_reduce</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">.</span><span class="n">pcooltime_reduce</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reuse_chance</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">.</span><span class="n">reuse_chance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prop_ignore</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">.</span><span class="n">prop_ignore</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">additional_target</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">.</span><span class="n">additional_target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">passive_level</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">.</span><span class="n">passive_level</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crit</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">.</span><span class="n">crit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crit_damage</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">.</span><span class="n">crit_damage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdamage</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">.</span><span class="n">pdamage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdamage_indep</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">.</span><span class="n">pdamage_indep</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdamage_indep</span> <span class="o">*</span> <span class="n">arg</span><span class="o">.</span><span class="n">pdamage_indep</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.01</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stat_main</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">.</span><span class="n">stat_main</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stat_sub</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">.</span><span class="n">stat_sub</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pstat_main</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">.</span><span class="n">pstat_main</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pstat_sub</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">.</span><span class="n">pstat_sub</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boss_pdamage</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">.</span><span class="n">boss_pdamage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">armor_ignore</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">-</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="p">((</span><span class="mi">100</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">armor_ignore</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">100</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">armor_ignore</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patt</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">.</span><span class="n">patt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">att</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">.</span><span class="n">att</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">stat_main_fixed</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">.</span><span class="n">stat_main_fixed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stat_sub_fixed</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">.</span><span class="n">stat_sub_fixed</span>
        <span class="k">return</span> <span class="bp">self</span>
        
    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ExtendedCharacterModifier</span><span class="p">(</span>
                        <span class="n">buff_rem</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buff_rem</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">buff_rem</span><span class="p">),</span>
                        <span class="n">summon_rem</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">summon_rem</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">summon_rem</span><span class="p">),</span>
                        <span class="n">cooltime_reduce</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cooltime_reduce</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">cooltime_reduce</span><span class="p">),</span>
                        <span class="n">pcooltime_reduce</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pcooltime_reduce</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">pcooltime_reduce</span><span class="p">),</span>
                        <span class="n">reuse_chance</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reuse_chance</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">reuse_chance</span><span class="p">),</span>
                        <span class="n">prop_ignore</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prop_ignore</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">prop_ignore</span><span class="p">),</span>
                        <span class="n">additional_target</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">additional_target</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">additional_target</span><span class="p">),</span>
                        <span class="n">passive_level</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">passive_level</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">passive_level</span><span class="p">),</span>
                        <span class="n">crit</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crit</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">crit</span><span class="p">),</span>
                        <span class="n">crit_damage</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crit_damage</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">crit_damage</span><span class="p">)</span> <span class="p">,</span>
                        <span class="n">pdamage</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdamage</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">pdamage</span><span class="p">),</span>
                        <span class="n">pdamage_indep</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdamage_indep</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">pdamage_indep</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdamage_indep</span> <span class="o">*</span> <span class="n">arg</span><span class="o">.</span><span class="n">pdamage_indep</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.01</span><span class="p">),</span>
                        <span class="n">stat_main</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_main</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">stat_main</span><span class="p">),</span>
                        <span class="n">stat_sub</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_sub</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">stat_sub</span><span class="p">),</span>
                        <span class="n">pstat_main</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pstat_main</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">pstat_main</span><span class="p">),</span>
                        <span class="n">pstat_sub</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pstat_sub</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">pstat_sub</span><span class="p">),</span>
                        <span class="n">boss_pdamage</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boss_pdamage</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">boss_pdamage</span><span class="p">),</span>
                        <span class="n">armor_ignore</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">-</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="p">((</span><span class="mi">100</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">armor_ignore</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">100</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">armor_ignore</span><span class="p">)),</span>
                        <span class="n">patt</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patt</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">patt</span><span class="p">),</span>
                        <span class="n">att</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">att</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">att</span><span class="p">),</span>
                        <span class="n">stat_main_fixed</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_main_fixed</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">stat_main_fixed</span><span class="p">),</span>
                        <span class="n">stat_sub_fixed</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_sub_fixed</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">stat_sub_fixed</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ExtendedCharacterModifier</span><span class="p">(</span>
                        <span class="n">buff_rem</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buff_rem</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">buff_rem</span><span class="p">),</span>
                        <span class="n">summon_rem</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">summon_rem</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">summon_rem</span><span class="p">),</span>
                        <span class="n">cooltime_reduce</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cooltime_reduce</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">cooltime_reduce</span><span class="p">),</span>
                        <span class="n">pcooltime_reduce</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pcooltime_reduce</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">pcooltime_reduce</span><span class="p">),</span>
                        <span class="n">reuse_chance</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reuse_chance</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">reuse_chance</span><span class="p">),</span>
                        <span class="n">prop_ignore</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prop_ignore</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">prop_ignore</span><span class="p">),</span>
                        <span class="n">additional_target</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">additional_target</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">additional_target</span><span class="p">),</span>
                        <span class="n">passive_level</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">passive_level</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">passive_level</span><span class="p">),</span>
                        <span class="n">crit</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crit</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">crit</span><span class="p">),</span>
                        <span class="n">crit_damage</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crit_damage</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">crit_damage</span><span class="p">),</span>
                        <span class="n">pdamage</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdamage</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">pdamage</span><span class="p">),</span>
                        <span class="n">pdamage_indep</span> <span class="o">=</span> <span class="p">(</span><span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdamage_indep</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">100</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">pdamage_indep</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">-</span> <span class="mi">100</span><span class="p">,</span>
                        <span class="n">stat_main</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_main</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">stat_main</span><span class="p">),</span>
                        <span class="n">stat_sub</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_sub</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">stat_sub</span><span class="p">),</span>
                        <span class="n">pstat_main</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pstat_main</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">pstat_main</span><span class="p">),</span>
                        <span class="n">pstat_sub</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pstat_sub</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">pstat_sub</span><span class="p">),</span>
                        <span class="n">boss_pdamage</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boss_pdamage</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">boss_pdamage</span><span class="p">),</span>
                        <span class="n">armor_ignore</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">-</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="mi">100</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">armor_ignore</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">100</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">armor_ignore</span><span class="p">),</span>
                        <span class="n">patt</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patt</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">patt</span><span class="p">),</span>
                        <span class="n">att</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">att</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">att</span><span class="p">),</span>
                        <span class="n">stat_main_fixed</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_main_fixed</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">stat_main_fixed</span><span class="p">),</span>
                        <span class="n">stat_sub_fixed</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_sub_fixed</span> <span class="o">-</span> <span class="n">arg</span><span class="o">.</span><span class="n">stat_sub_fixed</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">InformedCharacterModifier</span><span class="p">(</span><span class="n">ExtendedCharacterModifier</span><span class="p">):</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="s2">&quot;name&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">InformedCharacterModifier</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span> <span class="nf">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ret_dict</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">InformedCharacterModifier</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
        <span class="n">ret_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">return</span> <span class="n">ret_dict</span>

<span class="k">class</span> <span class="nc">VSkillModifier</span><span class="p">():</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_reinforcement</span><span class="p">(</span><span class="n">incr</span><span class="p">,</span> <span class="n">lv</span><span class="p">,</span> <span class="n">crit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="n">armor</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">lv</span> <span class="o">&gt;=</span> <span class="mi">40</span><span class="p">:</span>
            <span class="n">armor</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="k">if</span> <span class="n">lv</span> <span class="o">&gt;=</span> <span class="mi">20</span> <span class="ow">and</span> <span class="n">crit</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CharacterModifier</span><span class="p">(</span><span class="n">crit</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">pdamage_indep</span> <span class="o">=</span> <span class="p">(</span><span class="n">lv</span> <span class="o">*</span> <span class="n">incr</span><span class="p">),</span> <span class="n">armor_ignore</span> <span class="o">=</span> <span class="n">armor</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CharacterModifier</span><span class="p">(</span><span class="n">crit</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pdamage_indep</span> <span class="o">=</span> <span class="p">(</span><span class="n">lv</span> <span class="o">*</span> <span class="n">incr</span><span class="p">),</span> <span class="n">armor_ignore</span> <span class="o">=</span> <span class="n">armor</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">AbstractSkill</span><span class="p">(</span><span class="n">EvaluativeGraphElement</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Skill must have information about it&#39;s name, it&#39;s using - delay, skill using cooltime.</span>
<span class="sd">    Basic functions</span>
<span class="sd">    </span>
<span class="sd">    Can be re - implemented, but not mandate : </span>
<span class="sd">    - dump_json : returns JSON for it&#39;s state.</span>
<span class="sd">    - load_json : from given JSON, set it&#39;s state.</span>
<span class="sd">    - get_info : return it&#39;s status as JSON.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">delay</span><span class="p">,</span> <span class="n">cooltime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rem</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">red</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AbstractSkill</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">namespace</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="o">=</span> <span class="s2">&quot;graph control&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_range</span><span class="p">():</span>            
            <span class="bp">self</span><span class="o">.</span><span class="n">rem</span> <span class="o">=</span> <span class="n">rem</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">red</span> <span class="o">=</span> <span class="n">red</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delay</span> <span class="o">=</span> <span class="n">delay</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cooltime</span> <span class="o">=</span> <span class="n">cooltime</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">explanation</span> <span class="o">=</span> <span class="kc">None</span>
    
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cooltime</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cooltime</span> <span class="o">=</span> <span class="n">NOTWANTTOEXECUTE</span>
                
    <span class="k">def</span> <span class="nf">_change_time_into_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number_or_Infinite</span><span class="p">,</span> <span class="n">divider</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lang</span> <span class="o">=</span> <span class="s2">&quot;ko&quot;</span><span class="p">):</span>
        <span class="n">lang_to_inf_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ko&quot;</span> <span class="p">:</span> <span class="s2">&quot;무한/자동발동불가&quot;</span><span class="p">,</span> <span class="s2">&quot;en&quot;</span> <span class="p">:</span> <span class="s2">&quot;Infinite&quot;</span> <span class="p">}</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">number_or_Infinite</span> <span class="o">-</span> <span class="n">NOTWANTTOEXECUTE</span> <span class="o">/</span> <span class="n">divider</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10000</span> <span class="o">/</span> <span class="n">divider</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">lang_to_inf_dict</span><span class="p">[</span><span class="n">lang</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">number_or_Infinite</span>
    
    <span class="k">def</span> <span class="nf">_parse_list_info_into_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">li</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>   <span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">li</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span>
    
    <span class="k">def</span> <span class="nf">set_explanation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explanation</span> <span class="o">=</span> <span class="n">strs</span>
    
    <span class="k">def</span> <span class="nf">get_explanation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lang</span> <span class="o">=</span> <span class="s2">&quot;ko&quot;</span><span class="p">,</span> <span class="n">expl_level</span> <span class="o">=</span> <span class="mi">2</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;level 0 / 1 / 2</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">explanation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">explanation</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_explanation_internal</span><span class="p">(</span><span class="n">lang</span> <span class="o">=</span> <span class="n">lang</span><span class="p">,</span> <span class="n">expl_level</span> <span class="o">=</span> <span class="n">expl_level</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_get_explanation_internal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detail</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">lang</span> <span class="o">=</span> <span class="s2">&quot;ko&quot;</span><span class="p">,</span> <span class="n">expl_level</span> <span class="o">=</span> <span class="mi">2</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s2">&quot;en&quot;</span><span class="p">:</span>
            <span class="n">li</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;skill name&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;AbstractSkill(Not implemented)&quot;</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">lang</span> <span class="o">==</span> <span class="s2">&quot;ko&quot;</span><span class="p">:</span>
            <span class="n">li</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;스킬 이름&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;분류&quot;</span><span class="p">,</span> <span class="s2">&quot;템플릿(상속되지 않음)&quot;</span><span class="p">)]</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_list_info_into_string</span><span class="p">(</span><span class="n">li</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">get_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expl_level</span> <span class="o">=</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">my_json</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;delay&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_change_time_into_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delay</span><span class="p">),</span> <span class="s2">&quot;cooltime&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_change_time_into_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cooltime</span><span class="p">),</span> <span class="s2">&quot;expl&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_explanation</span><span class="p">(</span><span class="n">expl_level</span> <span class="o">=</span> <span class="n">expl_level</span><span class="p">)}</span>
        <span class="k">return</span> <span class="n">my_json</span>  

    <span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wrapper</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">isV</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enhancer</span><span class="p">,</span> <span class="n">use_index</span><span class="p">,</span> <span class="n">upgrade_index</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Speed hack</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">enhancer</span><span class="o">.</span><span class="n">add_v_skill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_index</span><span class="p">,</span> <span class="n">upgrade_index</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>


<span class="k">class</span> <span class="nc">BuffSkill</span><span class="p">(</span><span class="n">AbstractSkill</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;BuffSkill : Implements AbstractSkill, which contains baisc information about Skill. </span>
<span class="sd">    Basic Templates for generating buff skill.</span>
<span class="sd">    - parameters</span>
<span class="sd">      </span>
<span class="sd">      .remain : Buff remainance</span>
<span class="sd">      .buff_remAvailFlag : Boolean whether buff remainance option could be applied or not. (Default : True)</span>
<span class="sd">      .static_character_modifier : Contains static - modifier.</span>
<span class="sd">      </span>
<span class="sd">      * go to CharacterModifier for find more detail about parameters.</span>
<span class="sd">      </span>
<span class="sd">    - methods</span>
<span class="sd">      </span>
<span class="sd">      Buff skill only need to return modifier, nothing else.</span>
<span class="sd">    </span>
<span class="sd">      .get_modifier() : returns CharacterModifier for Character.</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">delay</span><span class="p">,</span> <span class="n">remain</span><span class="p">,</span>  <span class="n">cooltime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">crit</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">crit_damage</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pdamage</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">stat_main</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">stat_sub</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pstat_main</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pstat_sub</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">boss_pdamage</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pdamage_indep</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">armor_ignore</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">patt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">att</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">stat_main_fixed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">stat_sub_fixed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rem</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">red</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">BuffSkill</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">delay</span><span class="p">,</span> <span class="n">cooltime</span> <span class="o">=</span> <span class="n">cooltime</span><span class="p">,</span> <span class="n">rem</span> <span class="o">=</span> <span class="n">rem</span><span class="p">,</span> <span class="n">red</span> <span class="o">=</span> <span class="n">red</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_range</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="o">=</span> <span class="s2">&quot;buff&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remain</span> <span class="o">=</span> <span class="n">remain</span>
            <span class="c1">#Build StaticModifier from given arguments</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">static_character_modifier</span> <span class="o">=</span> <span class="n">CharacterModifier</span><span class="p">(</span><span class="n">crit</span> <span class="o">=</span> <span class="n">crit</span><span class="p">,</span> <span class="n">crit_damage</span> <span class="o">=</span> <span class="n">crit_damage</span><span class="p">,</span> <span class="n">pdamage</span> <span class="o">=</span> <span class="n">pdamage</span><span class="p">,</span> <span class="n">pdamage_indep</span> <span class="o">=</span> <span class="n">pdamage_indep</span><span class="p">,</span> <span class="n">stat_main</span> <span class="o">=</span> <span class="n">stat_main</span><span class="p">,</span> <span class="n">stat_sub</span> <span class="o">=</span> <span class="n">stat_sub</span><span class="p">,</span> <span class="n">pstat_main</span> <span class="o">=</span> <span class="n">pstat_main</span><span class="p">,</span> <span class="n">pstat_sub</span> <span class="o">=</span> <span class="n">pstat_sub</span><span class="p">,</span> <span class="n">boss_pdamage</span> <span class="o">=</span> <span class="n">boss_pdamage</span><span class="p">,</span> <span class="n">armor_ignore</span> <span class="o">=</span> <span class="n">armor_ignore</span><span class="p">,</span> <span class="n">patt</span> <span class="o">=</span> <span class="n">patt</span><span class="p">,</span> <span class="n">att</span> <span class="o">=</span> <span class="n">att</span><span class="p">,</span> <span class="n">stat_main_fixed</span> <span class="o">=</span> <span class="n">stat_main_fixed</span><span class="p">,</span> <span class="n">stat_sub_fixed</span> <span class="o">=</span> <span class="n">stat_sub_fixed</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_explanation_internal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detail</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">lang</span> <span class="o">=</span> <span class="s2">&quot;ko&quot;</span><span class="p">,</span> <span class="n">expl_level</span> <span class="o">=</span> <span class="mi">2</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s2">&quot;ko&quot;</span><span class="p">:</span>
            <span class="n">li</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;스킬 이름&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;분류&quot;</span><span class="p">,</span><span class="s2">&quot;버프&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;딜레이&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">%.1f</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">delay</span><span class="p">,</span> <span class="s2">&quot;ms&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;지속 시간&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_change_time_into_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remain</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">divider</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">),</span> <span class="s2">&quot;s&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;쿨타임&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_change_time_into_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cooltime</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">divider</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">),</span> <span class="s2">&quot;s&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;쿨타임 감소 가능 여부&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">red</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;지속시간 증가 여부&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rem</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;효과&quot;</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>  <span class="p">[(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;+&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span> <span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">static_character_modifier</span><span class="o">.</span><span class="n">abstract_log_list</span><span class="p">()</span> <span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;+미발동&quot;</span><span class="p">,</span> <span class="s2">&quot; 미발동&quot;</span><span class="p">))</span> <span class="p">]</span>     
        
        <span class="k">if</span> <span class="n">expl_level</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">li</span> <span class="o">=</span> <span class="p">[</span><span class="n">li</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">li</span><span class="p">[</span><span class="mi">7</span><span class="p">]]</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_list_info_into_string</span><span class="p">(</span><span class="n">li</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_modifier</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;You can override this function if needed(When your buff skill needs complicated calculation)</span>
<span class="sd">        * If your buff skill varies with time (e.g. Infinity), following modifier is recommended to calculate in ModifierWrapper.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">static_character_modifier</span>
        

<span class="k">class</span> <span class="nc">DamageSkill</span><span class="p">(</span><span class="n">AbstractSkill</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;DamageSkill : Implement AbstractSkill, which  contains baisc information about Skill. </span>
<span class="sd">    Basic Template for generating deal skills.</span>
<span class="sd">    - methods</span>
<span class="sd">      .getSkillDamage() : returns Damage % for Character.</span>
<span class="sd">      .get_modifier() : returns CharacterModifier for Character.</span>
<span class="sd">      </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">delay</span><span class="p">,</span> <span class="n">damage</span><span class="p">,</span> <span class="n">hit</span><span class="p">,</span>  <span class="n">cooltime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">modifier</span> <span class="o">=</span> <span class="n">CharacterModifier</span><span class="p">(),</span> <span class="n">red</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DamageSkill</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">delay</span><span class="p">,</span> <span class="n">cooltime</span> <span class="o">=</span> <span class="n">cooltime</span><span class="p">,</span> <span class="n">rem</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">red</span> <span class="o">=</span> <span class="n">red</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_range</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="o">=</span> <span class="s2">&quot;damage&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">damage</span> <span class="o">=</span> <span class="n">damage</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hit</span> <span class="o">=</span> <span class="n">hit</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_static_skill_modifier</span> <span class="o">=</span> <span class="n">modifier</span> <span class="c1">#Issue : Will we need this option really?</span>

    <span class="k">def</span> <span class="nf">_get_explanation_internal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detail</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">lang</span> <span class="o">=</span> <span class="s2">&quot;ko&quot;</span><span class="p">,</span> <span class="n">expl_level</span> <span class="o">=</span> <span class="mi">2</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s2">&quot;ko&quot;</span><span class="p">:</span>
            <span class="n">li</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;스킬 이름&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;분류&quot;</span><span class="p">,</span><span class="s2">&quot;공격기&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;딜레이&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">%.1f</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">delay</span><span class="p">,</span> <span class="s2">&quot;ms&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;퍼뎀&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%.1f</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">damage</span><span class="p">,</span><span class="s2">&quot;%&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;타격수&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hit</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;쿨타임&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_change_time_into_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cooltime</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">divider</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">),</span> <span class="s2">&quot;s&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;쿨타임 감소 가능 여부&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">red</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;지속시간 증가 여부&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rem</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;추가효과&quot;</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>  <span class="p">[(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;+&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span> <span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_static_skill_modifier</span><span class="o">.</span><span class="n">abstract_log_list</span><span class="p">()</span> <span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;+미발동%&quot;</span><span class="p">,</span> <span class="s2">&quot; 미발동&quot;</span><span class="p">))</span> <span class="p">]</span>    
        
        <span class="k">if</span> <span class="n">expl_level</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">li</span> <span class="o">=</span> <span class="n">li</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">li</span><span class="p">[</span><span class="mi">8</span><span class="p">]]</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_list_info_into_string</span><span class="p">(</span><span class="n">li</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">setV</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v_enhancer</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">incr</span><span class="p">,</span> <span class="n">crit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_static_skill_modifier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_static_skill_modifier</span> <span class="o">+</span> <span class="n">v_enhancer</span><span class="o">.</span><span class="n">get_reinforcement_with_register</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">incr</span><span class="p">,</span> <span class="n">crit</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
        
    <span class="k">def</span> <span class="nf">get_modifier</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_static_skill_modifier</span>
        
    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DamageSkill</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">delay</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">damage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hit</span><span class="p">,</span> <span class="n">cooltime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cooltime</span><span class="p">,</span> <span class="n">modifier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_static_skill_modifier</span><span class="p">,</span> <span class="n">red</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">red</span><span class="p">)</span>
        

<span class="c1">#TODO: optimize this factor more constructively</span>
<span class="k">class</span> <span class="nc">SummonSkill</span><span class="p">(</span><span class="n">AbstractSkill</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">summondelay</span><span class="p">,</span> <span class="n">delay</span><span class="p">,</span> <span class="n">damage</span><span class="p">,</span> <span class="n">hit</span><span class="p">,</span> <span class="n">remain</span><span class="p">,</span> <span class="n">cooltime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">modifier</span> <span class="o">=</span> <span class="n">CharacterModifier</span><span class="p">(),</span> <span class="n">rem</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">red</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SummonSkill</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">delay</span><span class="p">,</span> <span class="n">cooltime</span> <span class="o">=</span> <span class="n">cooltime</span><span class="p">,</span> <span class="n">rem</span> <span class="o">=</span> <span class="n">rem</span><span class="p">,</span> <span class="n">red</span> <span class="o">=</span> <span class="n">red</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_range</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="o">=</span> <span class="s2">&quot;summon&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">summondelay</span> <span class="o">=</span> <span class="n">summondelay</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">damage</span> <span class="o">=</span> <span class="n">damage</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hit</span> <span class="o">=</span> <span class="n">hit</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remain</span> <span class="o">=</span> <span class="n">remain</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_static_skill_modifier</span> <span class="o">=</span> <span class="n">modifier</span>

    <span class="k">def</span> <span class="nf">_get_explanation_internal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detail</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">lang</span> <span class="o">=</span> <span class="s2">&quot;ko&quot;</span><span class="p">,</span> <span class="n">expl_level</span> <span class="o">=</span> <span class="mi">2</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s2">&quot;ko&quot;</span><span class="p">:</span>
            <span class="n">li</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;스킬 이름&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;분류&quot;</span><span class="p">,</span><span class="s2">&quot;소환기&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;딜레이&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">%.1f</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">summondelay</span><span class="p">,</span> <span class="s2">&quot;ms&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;타격주기&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%.1f</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">delay</span><span class="p">,</span> <span class="s2">&quot;ms&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;퍼뎀&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%.1f</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">damage</span><span class="p">,</span><span class="s2">&quot;%&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;타격수&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hit</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;지속 시간&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_change_time_into_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remain</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">divider</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">),</span> <span class="s2">&quot;s&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;쿨타임&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_change_time_into_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cooltime</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">divider</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">),</span> <span class="s2">&quot;s&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;쿨타임 감소 가능 여부&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">red</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;지속시간 증가 여부&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rem</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;추가효과&quot;</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>  <span class="p">[(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;+&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span> <span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_static_skill_modifier</span><span class="o">.</span><span class="n">abstract_log_list</span><span class="p">()</span> <span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;+미발동%&quot;</span><span class="p">,</span> <span class="s2">&quot; 미발동&quot;</span><span class="p">))</span> <span class="p">]</span>   
        
        <span class="k">if</span> <span class="n">expl_level</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">li</span> <span class="o">=</span> <span class="n">li</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">li</span><span class="p">[</span><span class="mi">10</span><span class="p">]]</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_list_info_into_string</span><span class="p">(</span><span class="n">li</span><span class="p">)</span>        

    <span class="k">def</span> <span class="nf">get_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expl_level</span> <span class="o">=</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">my_json</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;delay&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_change_time_into_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">summondelay</span><span class="p">),</span> <span class="s2">&quot;cooltime&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_change_time_into_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cooltime</span><span class="p">),</span> <span class="s2">&quot;expl&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_explanation</span><span class="p">(</span><span class="n">expl_level</span> <span class="o">=</span> <span class="n">expl_level</span><span class="p">)}</span>
        <span class="k">return</span> <span class="n">my_json</span> 
    
    <span class="k">def</span> <span class="nf">setV</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v_enhancer</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">incr</span><span class="p">,</span> <span class="n">crit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_static_skill_modifier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_static_skill_modifier</span> <span class="o">+</span> <span class="n">v_enhancer</span><span class="o">.</span><span class="n">get_reinforcement_with_register</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">incr</span><span class="p">,</span> <span class="n">crit</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

        
    <span class="k">def</span> <span class="nf">get_modifier</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_static_skill_modifier</span>

<span class="k">class</span> <span class="nc">DotSkill</span><span class="p">(</span><span class="n">SummonSkill</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">damage</span><span class="p">,</span> <span class="n">remain</span><span class="p">,</span> <span class="n">cooltime</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DotSkill</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">damage</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">remain</span><span class="p">,</span> <span class="n">cooltime</span> <span class="o">=</span> <span class="n">cooltime</span><span class="p">,</span> <span class="n">modifier</span> <span class="o">=</span> <span class="n">CharacterModifier</span><span class="p">(</span><span class="n">crit</span><span class="o">=-</span><span class="mi">9999</span><span class="p">,</span> <span class="n">armor_ignore</span><span class="o">=</span><span class="mi">100</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="o">=</span> <span class="s2">&quot;dot&quot;</span>

    <span class="k">def</span> <span class="nf">_get_explanation_internal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detail</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">lang</span> <span class="o">=</span> <span class="s2">&quot;ko&quot;</span><span class="p">,</span> <span class="n">expl_level</span> <span class="o">=</span> <span class="mi">2</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s2">&quot;ko&quot;</span><span class="p">:</span>
            <span class="n">li</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;스킬 이름&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;분류&quot;</span><span class="p">,</span><span class="s2">&quot;도트뎀&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;딜레이&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">%.1f</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">summondelay</span><span class="p">,</span> <span class="s2">&quot;ms&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;타격주기&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%.1f</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">delay</span><span class="p">,</span><span class="s2">&quot;ms&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;퍼뎀&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%.1f</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">damage</span><span class="p">,</span><span class="s2">&quot;%&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;타격수&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hit</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;지속 시간&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_change_time_into_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remain</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">divider</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">),</span> <span class="s2">&quot;s&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;쿨타임&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_change_time_into_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cooltime</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">divider</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">),</span> <span class="s2">&quot;s&quot;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;쿨타임 감소 가능 여부&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">red</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;지속시간 증가 여부&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rem</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;추가효과&quot;</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>  <span class="p">[(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;+&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span> <span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_static_skill_modifier</span><span class="o">.</span><span class="n">abstract_log_list</span><span class="p">()</span> <span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;+미발동%&quot;</span><span class="p">,</span> <span class="s2">&quot; 미발동&quot;</span><span class="p">))</span> <span class="p">]</span>   
        
        
        <span class="k">if</span> <span class="n">expl_level</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">li</span> <span class="o">=</span> <span class="n">li</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">li</span><span class="p">[</span><span class="mi">10</span><span class="p">]]</span>
            
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_list_info_into_string</span><span class="p">(</span><span class="n">li</span><span class="p">)</span>
        
<span class="k">class</span> <span class="nc">Task</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">ftn</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ref</span> <span class="o">=</span> <span class="n">ref</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ftn</span> <span class="o">=</span> <span class="n">ftn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_after</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_before</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_justAfter</span> <span class="o">=</span> <span class="p">[]</span>
        
    <span class="k">def</span> <span class="nf">getRef</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ref</span>
        
    <span class="k">def</span> <span class="nf">do</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ftn</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">onAfter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">afters</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_after</span> <span class="o">+=</span> <span class="n">afters</span>
        
    <span class="k">def</span> <span class="nf">onBefore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">befores</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_before</span> <span class="o">+=</span> <span class="n">befores</span>
        
    <span class="k">def</span> <span class="nf">onJustAfter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jafters</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_justAfter</span> <span class="o">+=</span> <span class="n">jafters</span>
        
    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">retTask</span> <span class="o">=</span> <span class="n">Task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ref</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ftn</span><span class="p">)</span>
        <span class="n">retTask</span><span class="o">.</span><span class="n">onAfter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_after</span><span class="p">)</span>
        <span class="n">retTask</span><span class="o">.</span><span class="n">onBefore</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_before</span><span class="p">)</span>
        <span class="n">retTask</span><span class="o">.</span><span class="n">onJustAfter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_justAfter</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">retTask</span>

<span class="k">class</span> <span class="nc">ContextReferringTask</span><span class="p">(</span><span class="n">Task</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">do</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ftn</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ResultObject</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delay</span><span class="p">,</span> <span class="n">mdf</span><span class="p">,</span> <span class="n">damage</span><span class="p">,</span> <span class="n">hit</span><span class="p">,</span> <span class="n">sname</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">cascade</span> <span class="o">=</span> <span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot;Result object must be static; alway to be ensure it is revealed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delay</span> <span class="o">=</span> <span class="n">DynamicVariableOperation</span><span class="o">.</span><span class="n">reveal_argument</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">damage</span> <span class="o">=</span> <span class="n">DynamicVariableOperation</span><span class="o">.</span><span class="n">reveal_argument</span><span class="p">(</span><span class="n">damage</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hit</span> <span class="o">=</span> <span class="n">DynamicVariableOperation</span><span class="o">.</span><span class="n">reveal_argument</span><span class="p">(</span><span class="n">hit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mdf</span> <span class="o">=</span> <span class="n">DynamicVariableOperation</span><span class="o">.</span><span class="n">reveal_argument</span><span class="p">(</span><span class="n">mdf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sname</span> <span class="o">=</span> <span class="n">DynamicVariableOperation</span><span class="o">.</span><span class="n">reveal_argument</span><span class="p">(</span><span class="n">sname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="o">=</span> <span class="n">DynamicVariableOperation</span><span class="o">.</span><span class="n">reveal_argument</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>        <span class="c1">#buff, deal, summon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">DynamicVariableOperation</span><span class="o">.</span><span class="n">reveal_argument</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cascade</span> <span class="o">=</span> <span class="n">DynamicVariableOperation</span><span class="o">.</span><span class="n">reveal_argument</span><span class="p">(</span><span class="n">cascade</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="kc">None</span>
        
    <span class="k">def</span> <span class="nf">setTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">time</span>

<span class="sd">&#39;&#39;&#39;Default Values. Forbidden to editting.</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">taskTerminater</span> <span class="o">=</span> <span class="n">ResultObject</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">CharacterModifier</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sname</span> <span class="o">=</span> <span class="s1">&#39;terminator&#39;</span><span class="p">,</span> <span class="n">spec</span> <span class="o">=</span> <span class="s1">&#39;graph control&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">AccessibleBossState</span><span class="p">:</span>
    <span class="n">NO_FLAG</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">LEVIATE</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">DISTANCE</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">INVINSIBLE</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">IMMUNE</span> <span class="o">=</span> <span class="mi">16</span>
    
    <span class="n">ALWAYS</span> <span class="o">=</span> <span class="mi">31</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

<div class="viewcode-block" id="GraphElement"><a class="viewcode-back" href="../../../GraphElement.html#dpmModule.kernel.core.GraphElement">[문서]</a><span class="k">class</span> <span class="nc">GraphElement</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Manage time dependent feature of each execution</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">Flag_Skill</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">Flag_BaseSkill</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">Flag_BuffSkill</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">Flag_DamageSkill</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">Flag_SummonSkill</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="n">Flag_Optional</span> <span class="o">=</span> <span class="mi">32</span>
    <span class="n">Flag_Repeat</span> <span class="o">=</span> <span class="mi">64</span>
    <span class="n">Flag_Constraint</span> <span class="o">=</span> <span class="mi">128</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialzie Graph Element.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        _id : str or AbstractDynamicVariableInstance</span>
<span class="sd">            해당 GraphElement가 부여받게 될 identifier입니다. unique할 필요는 없습니다.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_id</span><span class="p">,</span> <span class="n">AbstractDynamicVariableInstance</span><span class="p">):</span>
            <span class="n">_id</span> <span class="o">=</span> <span class="n">_id</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_id</span> <span class="o">=</span> <span class="n">_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_before</span> <span class="o">=</span> <span class="p">[]</span>   <span class="c1">#Tasks that must be executed before this task.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_after</span> <span class="o">=</span> <span class="p">[]</span>    <span class="c1">#Tasks that must be executed after this task.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_justAfter</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_result_object_cache</span> <span class="o">=</span> <span class="n">ResultObject</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">CharacterModifier</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sname</span> <span class="o">=</span> <span class="s1">&#39;Graph Element&#39;</span><span class="p">,</span> <span class="n">spec</span> <span class="o">=</span> <span class="s1">&#39;graph control&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flag</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accessible_boss_state</span> <span class="o">=</span> <span class="n">AccessibleBossState</span><span class="o">.</span><span class="n">NO_FLAG</span>
        
    <span class="k">def</span> <span class="nf">fixAccesibleBossState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boss_state</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accessible_boss_state</span> <span class="o">=</span> <span class="n">boss_state</span>
    
    <span class="k">def</span> <span class="nf">removeAccesibleBossState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boss_state</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accessible_boss_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accessible_boss_state</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">boss_state</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">setAccesibleBossState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boss_state</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accessible_boss_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accessible_boss_state</span> <span class="o">|</span> <span class="p">(</span><span class="n">boss_state</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_flag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flag</span> <span class="o">|</span> <span class="n">flag</span>
        
    <span class="k">def</span> <span class="nf">toggle_flag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flag</span> <span class="o">^</span> <span class="n">flag</span>
    
    <span class="k">def</span> <span class="nf">remove_flag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flag</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">flag</span><span class="p">)</span>
    
<div class="viewcode-block" id="GraphElement.get_link"><a class="viewcode-back" href="../../../GraphElement.html#dpmModule.kernel.core.GraphElement.get_link">[문서]</a>    <span class="k">def</span> <span class="nf">get_link</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        주어진 Element가 상호작용하는 다른 Element들을 가져옵니다.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of [self, GraphElement, link_type(string)]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">li</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_before</span><span class="p">:</span>
            <span class="n">li</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="s2">&quot;before&quot;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_after</span><span class="p">:</span>
            <span class="n">li</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="s2">&quot;after&quot;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_justAfter</span><span class="p">:</span>
            <span class="n">li</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="s2">&quot;after&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">li</span></div>

<div class="viewcode-block" id="GraphElement.get_explanation"><a class="viewcode-back" href="../../../GraphElement.html#dpmModule.kernel.core.GraphElement.get_explanation">[문서]</a>    <span class="k">def</span> <span class="nf">get_explanation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lang</span> <span class="o">=</span> <span class="s2">&quot;ko&quot;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        해당 그래프 요소에 대한 설명을 받아옵니다.</span>

<span class="sd">        이 함수는 상속 과정에서 재정의 되는 것이 좋습니다.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lang</span>
<span class="sd">            Language type. Korean : ko, English : en.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        string</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s2">&quot;ko&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;종류:그래프 요소&quot;</span>
        <span class="k">elif</span> <span class="n">lang</span> <span class="o">==</span> <span class="s2">&quot;en&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Type:graph Element&quot;</span></div>
        
    <span class="k">def</span> <span class="nf">_use</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ResultObject</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        해당 그래프 요소를 작동시키고자 할 때 수행해야 하는 작업을 정의합니다.</span>

<span class="sd">        이 함수는 상속 과정에서 반드시 재정의되어야 합니다.</span>

<span class="sd">        Returns</span>
<span class="sd">        ------</span>
<span class="sd">        ResultObject</span>
<span class="sd">            해당 그래프 요소가 작동하고 난 후의 결과물</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_result_object_cache</span>
        
<div class="viewcode-block" id="GraphElement.build_task"><a class="viewcode-back" href="../../../GraphElement.html#dpmModule.kernel.core.GraphElement.build_task">[문서]</a>    <span class="k">def</span> <span class="nf">build_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skill_modifier</span> <span class="p">:</span> <span class="n">SkillModifier</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Task</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        그래프 요소의 실행을 정의하는 Task를 반환합니다.</span>
<span class="sd">        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        skill_modifier: SkillModifier</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Task</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">task</span> <span class="o">=</span> <span class="n">Task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sync</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">skill_modifier</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">task</span></div>
        
<div class="viewcode-block" id="GraphElement.spend_time"><a class="viewcode-back" href="../../../GraphElement.html#dpmModule.kernel.core.GraphElement.spend_time">[문서]</a>    <span class="k">def</span> <span class="nf">spend_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;        </span>
<span class="sd">        시간이 흘렀을 때의 행동을 정의합니다.</span>
<span class="sd">        이 함수는 ``Simulator`` 에 의해서 전체 ``GraphElement`` 들이 일괄적으로 처리될 때 호출됩니다.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        time : float</span>
<span class="sd">            지나간 시간입니다.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span></div>
        
<div class="viewcode-block" id="GraphElement.onAfter"><a class="viewcode-back" href="../../../GraphElement.html#dpmModule.kernel.core.GraphElement.onAfter">[문서]</a>    <span class="k">def</span> <span class="nf">onAfter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">el</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;해당 그래프 요소가 실행된 후에 el 요소를 실행하도록 합니다.</span>
<span class="sd">        만약 ``onAfter`` 를 통해 chaining된 GraphElement는 해당 그래프 요소가 실행되었다면, 어떠한 경우에 있어서도 chaining됩니다.</span>

<span class="sd">        onAfter메서드가 두 번 호출되었다면, 먼저 호출에 포함된 인자가 우선 수행됩니다.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        el : GraphElement</span>
<span class="sd">            다음에 실행되어야 할 ``GraphElement``</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_after</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_after</span> </div>
        
    <span class="k">def</span> <span class="nf">onAfters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ellist</span> <span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_after</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_after</span>  <span class="o">+</span> <span class="n">ellist</span>
        
<div class="viewcode-block" id="GraphElement.onBefore"><a class="viewcode-back" href="../../../GraphElement.html#dpmModule.kernel.core.GraphElement.onBefore">[문서]</a>    <span class="k">def</span> <span class="nf">onBefore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">el</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;해당 그래프 요소가 실행된 후에 el 요소를 실행하도록 합니다.</span>
<span class="sd">        만약 ``onBefore`` 를 통해 chaining된 GraphElement는 해당 그래프 요소가 실행되었다면, 어떠한 경우에 있어서도 chaining됩니다.</span>

<span class="sd">        onAfter메서드가 두 번 호출되었다면, 먼저 호출에 포함된 인자가 나중에 수행됩니다.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        el : GraphElement</span>
<span class="sd">            이전에 실행되어야 할 ``GraphElement``</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_before</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_before</span> <span class="o">+</span> <span class="p">[</span><span class="n">el</span><span class="p">]</span></div>
        
    <span class="k">def</span> <span class="nf">onBefores</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ellist</span> <span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_before</span> <span class="o">+=</span> <span class="n">ellist</span>
        
<div class="viewcode-block" id="GraphElement.sync"><a class="viewcode-back" href="../../../GraphElement.html#dpmModule.kernel.core.GraphElement.sync">[문서]</a>    <span class="k">def</span> <span class="nf">sync</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">,</span> <span class="n">skill_modifier</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        주어진 ``task`` 가 자신과 연결된 다른 ``GraphElement`` 와 동일한 연결 구조를 가지도록 합니다.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        task : Task</span>
<span class="sd">        skill_modifier : SkillModifier</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">task</span><span class="o">.</span><span class="n">onBefore</span><span class="p">([</span><span class="n">el</span><span class="o">.</span><span class="n">build_task</span><span class="p">(</span><span class="n">skill_modifier</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_before</span><span class="p">])</span>
        <span class="n">task</span><span class="o">.</span><span class="n">onAfter</span><span class="p">([</span><span class="n">el</span><span class="o">.</span><span class="n">build_task</span><span class="p">(</span><span class="n">skill_modifier</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_after</span><span class="p">])</span>
        <span class="n">task</span><span class="o">.</span><span class="n">onJustAfter</span><span class="p">([</span><span class="n">el</span><span class="o">.</span><span class="n">build_task</span><span class="p">(</span><span class="n">skill_modifier</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_justAfter</span><span class="p">)])</span></div>
        
    <span class="k">def</span> <span class="nf">onJustAfter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_justAfter</span> <span class="o">+=</span> <span class="p">[</span><span class="n">task</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_justAfter</span>
        
    <span class="k">def</span> <span class="nf">onJustAfters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taskli</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_justAfter</span> <span class="o">+=</span> <span class="n">taskli</span>       
    
    <span class="k">def</span> <span class="nf">ignore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>
    
    <span class="k">def</span> <span class="nf">ensure_condition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cond</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cond</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
    
<div class="viewcode-block" id="GraphElement.ensure"><a class="viewcode-back" href="../../../GraphElement.html#dpmModule.kernel.core.GraphElement.ensure">[문서]</a>    <span class="k">def</span> <span class="nf">ensure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ehc</span><span class="p">,</span> <span class="n">index_1</span><span class="p">,</span> <span class="n">index_2</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;주어진 ``ehc`` 의 코어 강화가 존재하지 않는다면, ``None`` 을 반환하여 실행되지 못하도록 막습니다.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ehc: AbstractVEnhancer</span>
<span class="sd">        index_1 : int</span>
<span class="sd">            ``ehc`` 가 첫번째 인자로 받게 될 index</span>
<span class="sd">        index_2 : int</span>
<span class="sd">            ``ehc`` 가 두번째 인자로 받게 될 index</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">ehc</span><span class="o">.</span><span class="n">getV</span><span class="p">(</span><span class="n">index_1</span><span class="p">,</span> <span class="n">index_2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div></div>
        

<div class="viewcode-block" id="TaskHolder"><a class="viewcode-back" href="../../../GraphElement.html#dpmModule.kernel.core.TaskHolder">[문서]</a><span class="k">class</span> <span class="nc">TaskHolder</span><span class="p">(</span><span class="n">GraphElement</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;This class only holds given task(Do not modify any property of task).</span>
<span class="sd">    주어진 Task를 수행하는 ``GraphElement`` 입니다. 단순히 ``Task`` 를 감싸기 위한 용도로 사용합니다.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;연결&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TaskHolder</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_taskholder</span> <span class="o">=</span> <span class="n">task</span>
    
    <span class="k">def</span> <span class="nf">get_explanation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lang</span> <span class="o">=</span> <span class="s2">&quot;ko&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s2">&quot;ko&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id</span>
        <span class="k">elif</span> <span class="n">lang</span> <span class="o">==</span> <span class="s2">&quot;en&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;type:task holder</span><span class="se">\n</span><span class="s2">name:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id</span>
        
    <span class="k">def</span> <span class="nf">build_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skill_modifier</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_taskholder</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sync</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">skill_modifier</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">task</span>
        
    <span class="k">def</span> <span class="nf">get_link</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">li</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">TaskHolder</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_link</span><span class="p">()</span>
        <span class="n">li</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_taskholder</span><span class="o">.</span><span class="n">getRef</span><span class="p">(),</span> <span class="s2">&quot;effect&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">li</span></div>

<span class="k">def</span> <span class="nf">create_task</span><span class="p">(</span><span class="n">task_name</span><span class="p">,</span> <span class="n">task_function</span><span class="p">,</span> <span class="n">task_ref</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">TaskHolder</span><span class="p">(</span><span class="n">Task</span><span class="p">(</span><span class="n">task_ref</span><span class="p">,</span> <span class="n">task_function</span><span class="p">),</span> <span class="n">task_name</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">OptionalTask</span><span class="p">(</span><span class="n">Task</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">discriminator</span><span class="p">,</span> <span class="n">task</span><span class="p">,</span> <span class="n">failtask</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;optionalTask&#39;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">OptionalTask</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_discriminator</span> <span class="o">=</span> <span class="n">discriminator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_result</span> <span class="o">=</span> <span class="n">task</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_failtask</span> <span class="o">=</span> <span class="n">failtask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_result_object_cache</span> <span class="o">=</span> <span class="n">ResultObject</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">CharacterModifier</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="n">spec</span> <span class="o">=</span> <span class="s1">&#39;graph control&#39;</span><span class="p">,</span> <span class="n">cascade</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_result</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">failtask</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fail</span> <span class="o">=</span> <span class="n">ResultObject</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">CharacterModifier</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">+</span> <span class="s2">&quot; fail&quot;</span><span class="p">,</span> <span class="n">spec</span> <span class="o">=</span> <span class="s1">&#39;graph control&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fail</span> <span class="o">=</span> <span class="n">ResultObject</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">CharacterModifier</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="n">spec</span> <span class="o">=</span> <span class="s1">&#39;graph control&#39;</span><span class="p">,</span> <span class="n">cascade</span> <span class="o">=</span> <span class="p">[</span><span class="n">failtask</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">do</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_discriminator</span><span class="p">()):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_result_object_cache</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fail</span>

<div class="viewcode-block" id="OptionalElement"><a class="viewcode-back" href="../../../GraphElement.html#dpmModule.kernel.core.OptionalElement">[문서]</a><span class="k">class</span> <span class="nc">OptionalElement</span><span class="p">(</span><span class="n">GraphElement</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;조건에 따라서, 다른 Task를 수행하는 ``GraphElement`` 입니다.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    disc : function</span>
<span class="sd">        조건 판별시에 수행될 함수입니다.</span>
<span class="sd">    after : GraphElement</span>
<span class="sd">        ``disc()`` 함수 호출의 반환값이 ``True`` 일 때 실행될 ``GraphElement`` 입니다.</span>
<span class="sd">    fail : GraphElement(default:None)</span>
<span class="sd">        ``disc()`` 함수 호출의 반환값이 ``False`` 일 때 실행될 ``GraphElement`` 입니다. 값이 주어지지 않을 경우 실행되지 않습니다.</span>
<span class="sd">    name : string</span>
<span class="sd">        ``GraphElement`` 의 이름입니다. Unique할 필요는 없습니다.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">disc</span><span class="p">,</span> <span class="n">after</span><span class="p">,</span> <span class="n">fail</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Optional Element&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">OptionalElement</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disc</span> <span class="o">=</span> <span class="n">disc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">after</span> <span class="o">=</span> <span class="n">after</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fail</span> <span class="o">=</span> <span class="n">fail</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_flag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Flag_Optional</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">get_explanation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lang</span> <span class="o">=</span> <span class="s2">&quot;ko&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s2">&quot;ko&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;종류:조건적 실행</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id</span>
        <span class="k">elif</span> <span class="n">lang</span> <span class="o">==</span> <span class="s2">&quot;en&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;type:Optional Element</span><span class="se">\n</span><span class="s2">name:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id</span>
        
    <span class="k">def</span> <span class="nf">build_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skill_modifier</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Task</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fail</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fail</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fail</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="o">.</span><span class="n">build_task</span><span class="p">(</span><span class="n">skill_modifier</span><span class="p">)</span>
        <span class="n">task</span> <span class="o">=</span> <span class="n">OptionalTask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">disc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">after</span><span class="o">.</span><span class="n">build_task</span><span class="p">(</span><span class="n">skill_modifier</span><span class="p">),</span> <span class="n">failtask</span> <span class="o">=</span> <span class="n">fail</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sync</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">skill_modifier</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">task</span>
        
    <span class="k">def</span> <span class="nf">get_link</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">li</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">OptionalElement</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_link</span><span class="p">()</span>
        <span class="n">li</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">after</span><span class="p">,</span> <span class="s2">&quot;if-true&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fail</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">li</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">,</span> <span class="s2">&quot;if-false&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">li</span></div>

<span class="k">class</span> <span class="nc">RepeatElement</span><span class="p">(</span><span class="n">GraphElement</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;주어진 ``GraphElement`` 를 반복 시행하고 싶을 때 사용합니다.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    target : GraphElement</span>
<span class="sd">        반복 수행할 대상</span>
<span class="sd">    itr : int</span>
<span class="sd">        반복 수행할 횟수</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">itr</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">회 반복&quot;</span> <span class="o">%</span> <span class="n">itr</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RepeatElement</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_repeat_target</span> <span class="o">=</span> <span class="n">target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">itr</span> <span class="o">=</span> <span class="n">itr</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">itr</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onAfter</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_flag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Flag_Repeat</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_result_object_cache</span> <span class="o">=</span> <span class="n">ResultObject</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">CharacterModifier</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sname</span> <span class="o">=</span> <span class="s1">&#39;Repeat Element&#39;</span><span class="p">,</span> <span class="n">spec</span> <span class="o">=</span> <span class="s1">&#39;graph control&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_explanation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lang</span> <span class="o">=</span> <span class="s2">&quot;ko&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s2">&quot;ko&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;종류:반복</span><span class="se">\n</span><span class="s2">이름:</span><span class="si">%s</span><span class="se">\n</span><span class="s2">반복대상:</span><span class="si">%s</span><span class="se">\n</span><span class="s2">반복 횟수:</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repeat_target</span><span class="o">.</span><span class="n">_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">itr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">lang</span> <span class="o">==</span> <span class="s2">&quot;en&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;type:Repeat Element</span><span class="se">\n</span><span class="s2">name:</span><span class="si">%s</span><span class="se">\n</span><span class="s2">target:</span><span class="si">%s</span><span class="se">\n</span><span class="s2">iterations:</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repeat_target</span><span class="o">.</span><span class="n">_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">itr</span><span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">_use</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_result_object_cache</span>
    
    <span class="k">def</span> <span class="nf">get_link</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">li</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">li</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repeat_target</span><span class="p">,</span> <span class="s2">&quot;repeat &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">itr</span><span class="p">)])</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_after</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">el</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repeat_target</span><span class="p">:</span>
                <span class="n">li</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="s2">&quot;after&quot;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_before</span><span class="p">:</span>
            <span class="n">li</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="s2">&quot;before&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">li</span>

<span class="k">class</span> <span class="nc">ConstraintElement</span><span class="p">(</span><span class="n">GraphElement</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;특정 요소의 검사를 Graph로 추적하기 위해 사용되는 더미 요소 입니다.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        ``constraint`` 에 대한 설명입니다.</span>
<span class="sd">    ref : GraphElement</span>
<span class="sd">        제한조건을 파악하기 위해 참조하는 ``GraphElement`` 입니다.</span>
<span class="sd">    cnst : function</span>
<span class="sd">        조건을 검사하고자 할 때 실행되는 함수입니다. ``False``가 반환될 경우 제한합니다.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">cnst</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ConstraintElement</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ref</span> <span class="o">=</span> <span class="n">ref</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ftn</span> <span class="o">=</span> <span class="n">cnst</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_flag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Flag_Constraint</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_explanation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lang</span> <span class="o">=</span> <span class="s2">&quot;ko&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s2">&quot;ko&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;종류:제한</span><span class="se">\n</span><span class="s2">이름:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id</span>
        <span class="k">elif</span> <span class="n">lang</span> <span class="o">==</span> <span class="s2">&quot;en&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;type:Constraint Element</span><span class="se">\n</span><span class="s2">name:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ftn</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">build_task</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;ConstraintElement must not builded.&quot;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">get_link</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[[</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ref</span><span class="p">,</span> <span class="s2">&quot;check&quot;</span><span class="p">]]</span>
        
<span class="k">class</span> <span class="nc">AbstractSkillWrapper</span><span class="p">(</span><span class="n">GraphElement</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;특정 스킬의 사용을 제어하는 ``GraphElement`` 입니다. 이 객체의 _use() 함수 호출은 </span>
<span class="sd">    인게임 내에서 대응되는 스킬의 시전과 동일하게 작용합니다.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    skill : AbstractSkill</span>
<span class="sd">        제어 대상이 되는 스킬입니다.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skill</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">AbstractSkillWrapper</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">skill</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">AbstractSkillWrapper</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_flag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Flag_Skill</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skill</span> <span class="o">=</span> <span class="n">skill</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">available</span> <span class="o">=</span> <span class="kc">True</span>   <span class="c1"># indicate whether this wrapper is usable.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cooltimeLeft</span> <span class="o">=</span> <span class="mi">0</span>   <span class="c1"># indicate how much tiume left for use again this wrapper.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLeft</span> <span class="o">=</span> <span class="mi">0</span>       <span class="c1"># indicate how much time left for continuing this wrapper.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constraint</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_result_object_cache</span> <span class="o">=</span> <span class="n">ResultObject</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">CharacterModifier</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">spec</span> <span class="o">=</span> <span class="s1">&#39;graph control&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">DynamicVariableOperation</span><span class="o">.</span><span class="n">reveal_argument</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">cooltime</span><span class="p">)</span> <span class="o">==</span> <span class="n">NOTWANTTOEXECUTE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_disabled_and_time_left</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accessible_boss_state</span> <span class="o">=</span> <span class="n">AccessibleBossState</span><span class="o">.</span><span class="n">NO_FLAG</span>

        <span class="c1"># Context referring</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_refer_runtime_context</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">enable_referring_runtime_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;If this is true, given skill wrapper may use runtime context.</span>
<span class="sd">        with this option, you MUST override _use() method with **kwargs argument is enabled.</span>
<span class="sd">        given context may passed by **kwargs option.</span>

<span class="sd">        이 함수가 호출될 경우, _use() 함수의 실행 시점에서 `runtime_context`를 참조할 수 있습니다.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_refer_runtime_context</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">protect_from_running</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; ``Scheduler`` 에 의해 이 객체가 선책되는 것을 방지합니다.</span>
<span class="sd">        이는 ``onAfter()`` 과 같은 chaining을 통한 실행은 막지 않습니다.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">constraint</span> <span class="o">=</span> <span class="n">ConstraintElement</span><span class="p">(</span><span class="s1">&#39;사용 금지&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onConstraint</span><span class="p">(</span><span class="n">constraint</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_explanation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lang</span> <span class="o">=</span> <span class="s2">&quot;ko&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">get_explanation</span><span class="p">(</span><span class="n">lang</span> <span class="o">=</span> <span class="n">lang</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">get_link</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">li</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">AbstractSkillWrapper</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_link</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraint</span><span class="p">:</span>
            <span class="n">li</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="s2">&quot;abstract&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">li</span>
        
    <span class="k">def</span> <span class="nf">assert_level_is_positive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reference_level</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">reference_level</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
    
    <span class="k">def</span> <span class="nf">createConstraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">const_name</span><span class="p">,</span> <span class="n">const_ref</span><span class="p">,</span> <span class="n">const_ftn</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onConstraint</span><span class="p">(</span><span class="n">ConstraintElement</span><span class="p">(</span><span class="n">const_name</span><span class="p">,</span> <span class="n">const_ref</span><span class="p">,</span> <span class="n">const_ftn</span><span class="p">))</span>
        
    <span class="k">def</span> <span class="nf">onConstraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constraint</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;주어진 제한 조건을 실행 ``constraint`` 목록에 추가합니다.</span>
<span class="sd">        해당 제한 조건이 만족되지 않을경우, 이 ``GraphElement``는 ``Scheduler`` 에 의해 실행되지 않습니다.</span>
<span class="sd">        </span>
<span class="sd">        이는 ``onAfter()`` 과 같은 chaining을 통한 실행은 막지 않습니다.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        constraint : ConstraintElement</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constraint</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">constraint</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">set_disabled_and_time_left</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;주어진 요소를 실행 불가 상태로 만들고, ``time`` 이후에 실행가능하도록 합니다.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        time : float(ms)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    
    <span class="k">def</span> <span class="nf">reduce_cooltime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ResultObject</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;주어진 요소의 남은 ``cooltime``을  ``time`` 만큼  감소시킵니다. </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        time : float(ms)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cooltimeLeft</span> <span class="o">-=</span> <span class="n">time</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_result_object_cache</span>

    <span class="k">def</span> <span class="nf">reduce_cooltime_p</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;주어진 요소의 남은 ``cooltime``을  ``p`` 만큼 비율로  감소시킵니다. </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        p : float</span>
<span class="sd">            0에서 1 사이의 값이어야 합니다. 1일 경우 모든 쿨타임이 제거됩니다. 0일 경우 아무 일도 일어나지 않습니다.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cooltimeLeft</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cooltimeLeft</span> <span class="o">*</span> <span class="n">p</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_result_object_cache</span>
    
    <span class="k">def</span> <span class="nf">controller</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">type_</span> <span class="o">=</span> <span class="s1">&#39;set_disabled_and_time_left&#39;</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TaskHolder</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39; ``AbstractSkillWrapper`` 의 시간을 제어하는 그래프 요소를 생성합니다.</span>
<span class="sd">        이 메서드는 ``TaskHolder`` 를 반환하므로, 반환된 요소를 다른 ``GraphElement`` 들의 ``onAfter`` 등을 통해 chaining할 수 있습니다.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        time : float</span>
<span class="sd">            ``reduce_cooltime_p`` 인 경우 0에서 1 사이의 값, 그렇지 않을 경우 ms단위의 시간</span>
<span class="sd">        type_ : str</span>
<span class="sd">            set_disabled_and_time_left, reduce_cooltime, reduce_cooltime_p, set_enabled_and_time_left</span>
<span class="sd">        name : str(default:None)</span>
<span class="sd">            반환될 요소의 이름</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        element : TaskHolder</span>
<span class="sd">            실행될 경우, 해당 ``GraphElement`` 의 잔여 시간을 제어하는 ``TaskHolder`` </span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">type_</span> <span class="o">==</span> <span class="s1">&#39;set_disabled_and_time_left&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">time</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">_name</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;사용 불가&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_name</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%.1f</span><span class="s2">초이후 시전&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">time</span><span class="o">*</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">1000</span><span class="p">))</span>
            <span class="n">task</span> <span class="o">=</span> <span class="n">Task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">set_disabled_and_time_left</span><span class="p">,</span> <span class="n">time</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">type_</span> <span class="o">==</span> <span class="s1">&#39;reduce_cooltime&#39;</span><span class="p">:</span>
            <span class="n">_name</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;쿨-</span><span class="si">%.1f</span><span class="s2">초&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">time</span><span class="o">*</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">1000</span><span class="p">))</span>
            <span class="n">task</span> <span class="o">=</span> <span class="n">Task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reduce_cooltime</span><span class="p">,</span> <span class="n">time</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">type_</span> <span class="o">==</span> <span class="s1">&#39;reduce_cooltime_p&#39;</span><span class="p">:</span>
            <span class="n">_name</span> <span class="o">=</span> <span class="s2">&quot;쿨-&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot;%&quot;</span>
            <span class="n">task</span> <span class="o">=</span> <span class="n">Task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reduce_cooltime_p</span><span class="p">,</span> <span class="n">time</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">type_</span> <span class="o">==</span> <span class="s1">&#39;set_enabled_and_time_left&#39;</span><span class="p">:</span>
            <span class="n">_name</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%.1f</span><span class="s2">초간 시전&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">time</span><span class="o">*</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">1000</span><span class="p">))</span>
            <span class="n">task</span> <span class="o">=</span> <span class="n">Task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">set_enabled_and_time_left</span><span class="p">,</span> <span class="n">time</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;You must specify control type correctly.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">TaskHolder</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">TaskHolder</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_use</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ftn</span><span class="p">,</span> <span class="n">skill_modifier</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ResultObject</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        
    <span class="k">def</span> <span class="nf">build_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skill_modifier</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Task</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_refer_runtime_context</span><span class="p">:</span>
            <span class="n">task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_task_with_referring_context</span><span class="p">(</span><span class="n">skill_modifier</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">task</span> <span class="o">=</span> <span class="n">Task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_use</span><span class="p">,</span> <span class="n">skill_modifier</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sync</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">skill_modifier</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">task</span>

    <span class="k">def</span> <span class="nf">_build_task_with_referring_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skill_modifier</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">context_referring_function</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>   <span class="c1"># Task가 실행시킬 함수</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use</span><span class="p">(</span><span class="n">skill_modifier</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">ContextReferringTask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context_referring_function</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">is_usable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;이 ``GraphElement`` 가 실행가능한지 여부를 반환합니다.</span>
<span class="sd">        이 과정에서 ``constraint`` 들은 검사됩니다.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">constraint</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">cnst</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraint</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">cnst</span><span class="o">.</span><span class="n">check</span><span class="p">():</span>
                    <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">available</span>

    <span class="k">def</span> <span class="nf">is_available</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;이 ``GraphElement`` 가 실행가능한지 여부를 반환합니다.</span>
<span class="sd">        이 과정에서 ``constraint`` 들은 검사되지 않습니다.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">available</span>
    
    <span class="k">def</span> <span class="nf">is_not_usable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;이 ``GraphElement`` 가 실행 불가능한지 여부를 반환합니다.</span>
<span class="sd">        이 과정에서 ``constraint`` 들은 검사됩니다.</span>
<span class="sd">        &#39;&#39;&#39;</span>        
        <span class="k">return</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_usable</span><span class="p">())</span>
        
    <span class="k">def</span> <span class="nf">spend_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">-=</span> <span class="n">time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cooltimeLeft</span> <span class="o">-=</span> <span class="n">time</span>
        
    <span class="k">def</span> <span class="nf">is_active</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;이 ``GraphElement`` 가 실행되고 있는지에 대한 여부를 반환합니다.</span>
<span class="sd">        지속 시간이 있는 객체에 대해서만 사용합니다.</span>
<span class="sd">        &#39;&#39;&#39;</span>  
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">onoff</span>

    <span class="k">def</span> <span class="nf">is_not_active</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">onoff</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">is_cooltime_left</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">direction</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;남은 쿨타임이 ``time`` 과 비교할 때의 대소를 반환합니다.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        time : float</span>
<span class="sd">            비교 기준이 되는 시간입니다.</span>
<span class="sd">        </span>
<span class="sd">        direction : 1 or -1</span>
<span class="sd">            direction &gt; 0 이면 ``time`` 보다 남은 ``cooltime`` 이 길 경우 True입니다.</span>
<span class="sd">            direction &lt; 0 이면 ``time`` 보다 남은 ``cooltime`` 이 짧을 경우 True입니다.</span>
<span class="sd">        &#39;&#39;&#39;</span>  
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cooltimeLeft</span> <span class="o">-</span> <span class="n">time</span><span class="p">)</span><span class="o">*</span><span class="n">direction</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span> <span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
        
    <span class="k">def</span> <span class="nf">is_time_left</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">direction</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;남은 지속시간이  ``time`` 과 비교할 때의 대소를 반환합니다.</span>
<span class="sd">    </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        time : float</span>
<span class="sd">            비교 기준이 되는 시간입니다.</span>
<span class="sd">        </span>
<span class="sd">        direction : 1 or -1</span>
<span class="sd">            direction &gt; 0 이면 ``time`` 보다 남은 지속시간이 길 경우 True입니다.</span>
<span class="sd">            direction &lt; 0 이면 ``time`` 보다 남은 지속시간이 짧을 경우 True입니다.</span>
<span class="sd">        &#39;&#39;&#39;</span>  
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeLeft</span> <span class="o">-</span> <span class="n">time</span><span class="p">)</span> <span class="o">*</span> <span class="n">direction</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">calculate_cooltime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skill_modifier</span><span class="p">:</span> <span class="n">SkillModifier</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; ``skill_modifier`` 를 바탕으로, 주어진 ``Skill`` 의 실질적 쿨타임을 계산합니다.</span>
<span class="sd">    </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        skill_modifier : SkillModifier</span>
<span class="sd">            현재 스킬을 사용하는 ``Character`` 가 제공한 ``SkillModifier`` 입니다.</span>
<span class="sd">        &#39;&#39;&#39;</span>  
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">red</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">cooltime</span>
            
        <span class="n">cooltime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">cooltime</span>
        <span class="n">pcooltime_reduce</span> <span class="o">=</span> <span class="n">skill_modifier</span><span class="o">.</span><span class="n">pcooltime_reduce</span> <span class="c1"># 쿨감%</span>
        <span class="n">cooltime_reduce</span> <span class="o">=</span> <span class="n">skill_modifier</span><span class="o">.</span><span class="n">cooltime_reduce</span> <span class="c1"># 쿨감+ (ms)</span>
        
        <span class="k">if</span> <span class="n">cooltime</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mf">0.01</span><span class="o">*</span><span class="n">pcooltime_reduce</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1000</span><span class="p">:</span> <span class="c1"># 쿨감%부터 적용, 최소 1초까지</span>
            <span class="n">cd</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">cooltime</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cd</span> <span class="o">=</span> <span class="n">cooltime</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mf">0.01</span><span class="o">*</span><span class="n">pcooltime_reduce</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">cd</span> <span class="o">-</span> <span class="n">cooltime_reduce</span> <span class="o">&lt;=</span> <span class="mi">10000</span><span class="p">:</span>
            <span class="n">cooltime_cap</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="n">cd</span><span class="p">)</span>
            <span class="n">cdr_left</span> <span class="o">=</span> <span class="p">(</span><span class="n">cooltime_reduce</span> <span class="o">-</span> <span class="p">(</span><span class="n">cd</span> <span class="o">-</span> <span class="n">cooltime_cap</span><span class="p">))</span> <span class="o">/</span> <span class="mi">1000</span> <span class="c1"># 10초 이하에서 쿨감되는 수치 계산</span>
            <span class="n">cdr_applied</span> <span class="o">=</span> <span class="n">cooltime_cap</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cdr_left</span> <span class="o">*</span> <span class="mf">0.05</span><span class="p">)</span> <span class="c1"># 1초당 5%씩 감소</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cdr_applied</span> <span class="o">=</span> <span class="n">cd</span> <span class="o">-</span> <span class="n">cooltime_reduce</span>
        
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">cdr_applied</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="mi">5000</span><span class="p">))</span> <span class="c1"># 5초까지 감소, 단 이미 스킬쿨이 5초 아래였을 경우 그대로 사용</span>

<span class="k">class</span> <span class="nc">BuffSkillWrapper</span><span class="p">(</span><span class="n">AbstractSkillWrapper</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skill</span> <span class="p">:</span> <span class="n">BuffSkill</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_disabledResultobjectCache</span> <span class="o">=</span> <span class="n">ResultObject</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">CharacterModifier</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sname</span> <span class="o">=</span> <span class="n">skill</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">spec</span> <span class="o">=</span> <span class="s1">&#39;graph control&#39;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">BuffSkillWrapper</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">skill</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_flag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Flag_BuffSkill</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onoff</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_end</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disabledModifier</span> <span class="o">=</span> <span class="n">CharacterModifier</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modifierInvariantFlag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accessible_boss_state</span> <span class="o">=</span> <span class="n">AccessibleBossState</span><span class="o">.</span><span class="n">ALWAYS</span>
        
    <span class="k">def</span> <span class="nf">set_enabled_and_time_left</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;This function must be carefull.. You must sure about this skill&#39;s cooltime calculation i.e. -1</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLeft</span> <span class="o">=</span> <span class="n">time</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">onoff</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cooltimeLeft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">cooltime</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onoff</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cooltimeLeft</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">available</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">mdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_modifier</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ResultObject</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mdf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;remain&quot;</span> <span class="p">:</span> <span class="n">time</span><span class="p">})</span>
        
    <span class="k">def</span> <span class="nf">set_disabled_and_time_left</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLeft</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cooltimeLeft</span> <span class="o">=</span> <span class="n">time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">available</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onoff</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">time</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cooltimeLeft</span> <span class="o">=</span> <span class="n">NOTWANTTOEXECUTE</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_disabledResultobjectCache</span>
        
    <span class="k">def</span> <span class="nf">spend_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span> <span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span> <span class="p">:</span>  <span class="c1">#TODO : can make this process more faster.. maybe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLeft</span> <span class="o">-=</span> <span class="n">time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cooltimeLeft</span> <span class="o">-=</span> <span class="n">time</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeLeft</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onoff</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cooltimeLeft</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">available</span> <span class="o">=</span> <span class="kc">True</span>
    
    <span class="k">def</span> <span class="nf">_use</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skill_modifier</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ResultObject</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLeft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">remain</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.01</span><span class="o">*</span><span class="n">skill_modifier</span><span class="o">.</span><span class="n">buff_rem</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">rem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cooltimeLeft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_cooltime</span><span class="p">(</span><span class="n">skill_modifier</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onoff</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cooltimeLeft</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">available</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">delay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">delay</span>
        <span class="c1">#mdf = self.get_modifier()</span>
        <span class="k">return</span> <span class="n">ResultObject</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span> <span class="n">CharacterModifier</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;remain&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">remain</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mf">0.01</span><span class="o">*</span><span class="n">skill_modifier</span><span class="o">.</span><span class="n">buff_rem</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">rem</span><span class="p">)})</span>

    <span class="k">def</span> <span class="nf">get_modifier</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CharacterModifier</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">onoff</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">get_modifier</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">disabledModifier</span>

    <span class="k">def</span> <span class="nf">get_modifier_forced</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">get_modifier</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">onEnd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">onEnds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tasklist</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_end</span> <span class="o">+=</span> <span class="n">tasklist</span>

<span class="k">class</span> <span class="nc">StackSkillWrapper</span><span class="p">(</span><span class="n">BuffSkillWrapper</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skill</span><span class="p">,</span> <span class="n">max_</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">StackSkillWrapper</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">skill</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max</span> <span class="o">=</span> <span class="n">max_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_style</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modifierInvariantFlag</span> <span class="o">=</span> <span class="kc">False</span>
    
    <span class="k">def</span> <span class="nf">set_name_style</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_style</span> <span class="o">=</span> <span class="n">style</span>
        
    <span class="k">def</span> <span class="nf">vary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">+</span> <span class="n">d</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ResultObject</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">CharacterModifier</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">spec</span> <span class="o">=</span> <span class="s1">&#39;graph control&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">set_stack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="n">d</span>
        <span class="k">return</span> <span class="n">ResultObject</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">CharacterModifier</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">spec</span> <span class="o">=</span> <span class="s1">&#39;graph control&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_modifier</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">CharacterModifier</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">stackController</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;vary&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">dtype</span><span class="o">==</span><span class="s1">&#39;vary&#39;</span><span class="p">:</span>
            <span class="n">task</span> <span class="o">=</span> <span class="n">Task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vary</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">dtype</span><span class="o">==</span><span class="s1">&#39;set&#39;</span><span class="p">:</span>
            <span class="n">task</span> <span class="o">=</span> <span class="n">Task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">set_stack</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span> <span class="o">%</span> <span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">TaskHolder</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">judge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="n">direction</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">-</span><span class="n">stack</span><span class="p">)</span><span class="o">*</span><span class="n">direction</span><span class="o">&gt;=</span><span class="mi">0</span>

<span class="k">class</span> <span class="nc">TimeStackSkillWrapper</span><span class="p">(</span><span class="n">AbstractSkillWrapper</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skill</span><span class="p">,</span> <span class="n">max_</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TimeStackSkillWrapper</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">skill</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max</span> <span class="o">=</span> <span class="n">max_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span> <span class="o">=</span> <span class="p">[]</span>
        
    <span class="k">def</span> <span class="nf">addStack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vary</span><span class="p">,</span> <span class="n">left</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">vary</span><span class="p">,</span> <span class="n">left</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">ResultObject</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">CharacterModifier</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">spec</span> <span class="o">=</span> <span class="s1">&#39;graph control&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">stackController</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vary</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">task</span> <span class="o">=</span> <span class="n">Task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addStack</span><span class="p">,</span> <span class="n">vary</span><span class="p">,</span> <span class="n">left</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">TaskHolder</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">spend_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
        <span class="n">queue</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="p">:</span>
            <span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">time</span>
            <span class="k">if</span> <span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span> <span class="o">=</span> <span class="n">queue</span>
    
    <span class="k">def</span> <span class="nf">getStack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span> 
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="p">:</span>
            <span class="n">total</span> <span class="o">+=</span> <span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">total</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">get_modifier</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">CharacterModifier</span><span class="p">()</span>
        
<span class="k">class</span> <span class="nc">DamageSkillWrapper</span><span class="p">(</span><span class="n">AbstractSkillWrapper</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skill</span> <span class="p">:</span> <span class="n">DamageSkill</span><span class="p">,</span> <span class="n">modifier</span> <span class="o">=</span> <span class="n">CharacterModifier</span><span class="p">(),</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DamageSkillWrapper</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">skill</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modifier</span> <span class="o">=</span> <span class="n">modifier</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accessible_boss_state</span> <span class="o">=</span> <span class="n">AccessibleBossState</span><span class="o">.</span><span class="n">NO_FLAG</span>

    <span class="k">def</span> <span class="nf">set_disabled_and_time_left</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cooltimeLeft</span> <span class="o">=</span> <span class="n">time</span>
        <span class="k">if</span> <span class="n">time</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cooltimeLeft</span> <span class="o">=</span> <span class="n">NOTWANTTOEXECUTE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">available</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">ResultObject</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">CharacterModifier</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">spec</span> <span class="o">=</span> <span class="s1">&#39;graph control&#39;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">spend_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span> <span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cooltimeLeft</span> <span class="o">-=</span> <span class="n">time</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cooltimeLeft</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">available</span> <span class="o">=</span> <span class="kc">True</span>
        
    <span class="k">def</span> <span class="nf">_use</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skill_modifier</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cooltimeLeft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_cooltime</span><span class="p">(</span><span class="n">skill_modifier</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cooltimeLeft</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">available</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">ResultObject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">delay</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_modifier</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">damage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">hit</span><span class="p">,</span> <span class="n">sname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">spec</span><span class="p">)</span>
        <span class="c1">#return delay, mdf, dmg, self.cascade</span>
        
    <span class="k">def</span> <span class="nf">get_modifier</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CharacterModifier</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">get_modifier</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifier</span>
        
<span class="k">class</span> <span class="nc">StackDamageSkillWrapper</span><span class="p">(</span><span class="n">DamageSkillWrapper</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skill</span> <span class="p">:</span> <span class="n">DamageSkill</span><span class="p">,</span> <span class="n">stack_skill</span><span class="p">:</span> <span class="n">AbstractSkillWrapper</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">modifier</span> <span class="o">=</span> <span class="n">CharacterModifier</span><span class="p">(),</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">StackDamageSkillWrapper</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">skill</span><span class="p">,</span> <span class="n">modifier</span> <span class="o">=</span> <span class="n">modifier</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stack_skill</span> <span class="o">=</span> <span class="n">stack_skill</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span>
        
    <span class="k">def</span> <span class="nf">_use</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skill_modifier</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cooltimeLeft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_cooltime</span><span class="p">(</span><span class="n">skill_modifier</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cooltimeLeft</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">available</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">stack</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack_skill</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">stack</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ResultObject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">delay</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_modifier</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">spec</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ResultObject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">delay</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_modifier</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">damage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">hit</span> <span class="o">*</span> <span class="n">stack</span><span class="p">,</span> <span class="n">sname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">spec</span><span class="p">)</span>

        
<span class="k">class</span> <span class="nc">SummonSkillWrapper</span><span class="p">(</span><span class="n">AbstractSkillWrapper</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skill</span> <span class="p">:</span> <span class="n">SummonSkill</span><span class="p">,</span> <span class="n">modifier</span> <span class="o">=</span> <span class="n">CharacterModifier</span><span class="p">(),</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SummonSkillWrapper</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">skill</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tick</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onoff</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modifier</span> <span class="o">=</span> <span class="n">modifier</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disabledModifier</span> <span class="o">=</span> <span class="n">CharacterModifier</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_onTick</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accessible_boss_state</span> <span class="o">=</span> <span class="n">AccessibleBossState</span><span class="o">.</span><span class="n">NO_FLAG</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_periodic</span> <span class="o">=</span> <span class="kc">True</span>
    
    <span class="k">def</span> <span class="nf">get_link</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">li</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">SummonSkillWrapper</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_link</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onTick</span><span class="p">:</span>
            <span class="n">li</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="s2">&quot;tick&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">li</span>
        
    <span class="k">def</span> <span class="nf">set_disabled_and_time_left</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onoff</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">available</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cooltimeLeft</span> <span class="o">=</span> <span class="n">time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLeft</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tick</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">time</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cooltimeLeft</span> <span class="o">=</span> <span class="n">NOTWANTTOEXECUTE</span>
        <span class="k">return</span> <span class="n">ResultObject</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">CharacterModifier</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">spec</span> <span class="o">=</span> <span class="s1">&#39;graph control&#39;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">need_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">onoff</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tick</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        
    <span class="k">def</span> <span class="nf">spend_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span> <span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLeft</span> <span class="o">-=</span> <span class="n">time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cooltimeLeft</span> <span class="o">-=</span> <span class="n">time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tick</span> <span class="o">-=</span> <span class="n">time</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeLeft</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onoff</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cooltimeLeft</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">available</span> <span class="o">=</span> <span class="kc">True</span>
    
    <span class="c1">#_use only alloted for start.</span>
    <span class="k">def</span> <span class="nf">_use</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skill_modifier</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tick</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onoff</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLeft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">remain</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mf">0.01</span><span class="o">*</span><span class="n">skill_modifier</span><span class="o">.</span><span class="n">summon_rem</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">rem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cooltimeLeft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_cooltime</span><span class="p">(</span><span class="n">skill_modifier</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cooltimeLeft</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">available</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">ResultObject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">summondelay</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">disabledModifier</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">spec</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_useTick</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">onoff</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tick</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tick</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">delay</span>
            <span class="k">return</span> <span class="n">ResultObject</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_modifier</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">damage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">hit</span><span class="p">,</span> <span class="n">sname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">spec</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ResultObject</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">disabledModifier</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">spec</span><span class="p">)</span>    
    
    <span class="k">def</span> <span class="nf">build_periodic_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skill_modifier</span><span class="p">):</span>
        <span class="n">task</span> <span class="o">=</span> <span class="n">Task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_useTick</span><span class="p">)</span>
        <span class="n">task</span><span class="o">.</span><span class="n">onAfter</span><span class="p">([</span><span class="n">el</span><span class="o">.</span><span class="n">build_task</span><span class="p">(</span><span class="n">skill_modifier</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onTick</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">task</span>
    
    <span class="k">def</span> <span class="nf">onTick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_onTick</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">onTicks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tasklist</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_onTick</span> <span class="o">+=</span> <span class="n">tasklist</span>
    
    <span class="k">def</span> <span class="nf">get_modifier</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">retMdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill</span><span class="o">.</span><span class="n">get_modifier</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifier</span>
        <span class="k">return</span> <span class="n">retMdf</span>
            
<span class="k">class</span> <span class="nc">Simulator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="s1">&#39;scheduler&#39;</span><span class="p">,</span> <span class="s1">&#39;character&#39;</span><span class="p">,</span> <span class="s1">&#39;analytics&#39;</span><span class="p">,</span> <span class="s1">&#39;_modifier_cache_and_time&#39;</span><span class="p">,</span> <span class="s1">&#39;_default_modifier&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scheduler</span><span class="p">,</span> <span class="n">chtr</span><span class="p">,</span> <span class="n">analytics</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span> <span class="o">=</span> <span class="n">scheduler</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">character</span> <span class="o">=</span> <span class="n">chtr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analytics</span> <span class="o">=</span> <span class="n">analytics</span>
        
        <span class="c1">#vEnhancer를 Analytics에서 확인할 수 있도록 합니다.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analytics</span><span class="o">.</span><span class="n">set_v_enhancer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">_vEhc</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        
        <span class="c1">#Buff modifier를 시간별도 캐싱하여 연산량을 줄입니다.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_modifier_cache_and_time</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">CharacterModifier</span><span class="p">()]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_default_modifier</span> <span class="o">=</span> <span class="n">CharacterModifier</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_default_modifier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modifier</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_modifier</span> <span class="o">=</span> <span class="n">modifier</span>

    <span class="k">def</span> <span class="nf">get_default_modifier</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_modifier</span>
    
    <span class="k">def</span> <span class="nf">get_skill_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">analytics</span><span class="o">.</span><span class="n">get_skill_info</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">analytics</span><span class="o">.</span><span class="n">get_results</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">character</span><span class="o">.</span><span class="n">get_buffed_modifier</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">analytics</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">getDPM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">restricted</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">restricted</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_unrestricted_DPM</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">analytics</span><span class="o">.</span><span class="n">total_damage</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">total_time_initial</span><span class="p">)</span> <span class="o">*</span> <span class="mi">60000</span>

    <span class="k">def</span> <span class="nf">get_unrestricted_DPM</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">analytics</span><span class="o">.</span><span class="n">total_damage_without_restriction</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">total_time_initial</span><span class="p">)</span> <span class="o">*</span> <span class="mi">60000</span>

    <span class="k">def</span> <span class="nf">getTotalDamage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">analytics</span><span class="o">.</span><span class="n">total_damage</span>
    
    <span class="k">def</span> <span class="nf">start_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_modifier_cache_and_time</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">CharacterModifier</span><span class="p">()]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analytics</span><span class="o">.</span><span class="n">set_total_runtime</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analytics</span><span class="o">.</span><span class="n">chtrmdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">character</span><span class="o">.</span><span class="n">get_modifier</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">character</span><span class="o">.</span><span class="n">generate_modifier_cache</span><span class="p">()</span>             <span class="c1"># 캐릭터의 Modifier를 매번 재계산 할 필요가 없으므로( 캐릭터의 상태는 시뮬레이션 도중 변화하지 않음) 캐싱하여 연산 자원을 절약합니다.</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">is_simulation_end</span><span class="p">():</span>
            <span class="n">task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">dequeue</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">run_task</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>    
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">_ref</span><span class="o">.</span><span class="n">_id</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error raised&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---&quot;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">e</span>
        
    <span class="k">def</span> <span class="nf">run_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_task_recursive</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">run_individual_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        try:</span>
<span class="sd">            print(task._ref._id)</span>
<span class="sd">        except:</span>
<span class="sd">            print(task)</span>
<span class="sd">            print(task.skill.name)</span>
<span class="sd">            raise AttributeError</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">stack</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">_before</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dt</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_individual_task</span><span class="p">(</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>

        <span class="n">runtime_context_modifier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">get_buff_modifier</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_modifier</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">do</span><span class="p">(</span><span class="n">runtime_context_modifier</span><span class="o">=</span><span class="n">runtime_context_modifier</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">character</span><span class="o">.</span><span class="n">get_modifier</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">damage</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">mdf</span> <span class="o">+=</span> <span class="n">runtime_context_modifier</span>
        <span class="n">result</span><span class="o">.</span><span class="n">setTime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">get_current_time</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analytics</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">character</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="n">dt</span> <span class="o">+=</span> <span class="n">result</span><span class="o">.</span><span class="n">delay</span>
        
        <span class="n">stack</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">_after</span> <span class="o">+</span> <span class="n">result</span><span class="o">.</span><span class="n">cascade</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dt</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_individual_task</span><span class="p">(</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">dt</span>

    <span class="k">def</span> <span class="nf">run_task_recursive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">):</span>
        <span class="n">stack</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">_before</span> <span class="o">+</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_task_recursive</span><span class="p">(</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>
        
        <span class="n">runtime_context_modifier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">get_buff_modifier</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_modifier</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">do</span><span class="p">(</span><span class="n">runtime_context_modifier</span><span class="o">=</span><span class="n">runtime_context_modifier</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">character</span><span class="o">.</span><span class="n">get_modifier</span><span class="p">())</span>
        
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">damage</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">mdf</span> <span class="o">+=</span> <span class="n">runtime_context_modifier</span>

        <span class="n">result</span><span class="o">.</span><span class="n">setTime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">get_current_time</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analytics</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">character</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        
        <span class="n">stk</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">_justAfter</span> <span class="o">+</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">stk</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_task_recursive</span><span class="p">(</span><span class="n">stk</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>
        
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">delay</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">spend_time</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">delay</span><span class="p">)</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">tick</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">get_delayed_task</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">tick</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">run_task_recursive</span><span class="p">(</span><span class="n">tick</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>
        
        <span class="n">stack</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">cascade</span> <span class="o">+</span> <span class="n">task</span><span class="o">.</span><span class="n">_after</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_task_recursive</span><span class="p">(</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>

<span class="k">class</span> <span class="nc">Analytics</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">printFlag</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_damage</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_damage_without_restriction</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta_save</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_calculation_progress</span> <span class="o">=</span> <span class="n">printFlag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skillList</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chtrmdf</span> <span class="o">=</span> <span class="n">CharacterModifier</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vEhc</span> <span class="o">=</span> <span class="kc">None</span>
        
    <span class="k">def</span> <span class="nf">set_v_enhancer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vEhc</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vEhc</span> <span class="o">=</span> <span class="n">vEhc</span>
        
    <span class="k">def</span> <span class="nf">set_total_runtime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totalTime</span> <span class="o">=</span> <span class="n">time</span>
    
    <span class="k">def</span> <span class="nf">analyze</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chtr</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_damage_from_result_with_log</span><span class="p">(</span><span class="n">chtr</span><span class="o">.</span><span class="n">get_modifier</span><span class="p">(),</span> <span class="n">result</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_skill_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;dict&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">skillList</span><span class="p">,</span> <span class="s2">&quot;li&quot;</span> <span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">skillList</span><span class="o">.</span><span class="n">keys</span><span class="p">())}</span>    
    
    <span class="k">def</span> <span class="nf">get_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mod</span><span class="p">):</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;stat_main&quot;</span> <span class="p">:</span> <span class="n">mod</span><span class="o">.</span><span class="n">stat_main</span><span class="p">,</span>
                <span class="s2">&quot;stat_sub&quot;</span> <span class="p">:</span> <span class="n">mod</span><span class="o">.</span><span class="n">stat_sub</span><span class="p">,</span>
                <span class="s2">&quot;stat_main_fixed&quot;</span> <span class="p">:</span> <span class="n">mod</span><span class="o">.</span><span class="n">stat_main_fixed</span><span class="p">,</span>
                <span class="s2">&quot;pstat_main&quot;</span> <span class="p">:</span> <span class="n">mod</span><span class="o">.</span><span class="n">pstat_main</span><span class="p">,</span>
                <span class="s2">&quot;att&quot;</span> <span class="p">:</span> <span class="n">mod</span><span class="o">.</span><span class="n">att</span><span class="p">,</span>
                <span class="s2">&quot;patt&quot;</span> <span class="p">:</span> <span class="n">mod</span><span class="o">.</span><span class="n">patt</span><span class="p">,</span>
                <span class="s2">&quot;pdamage&quot;</span> <span class="p">:</span> <span class="n">mod</span><span class="o">.</span><span class="n">pdamage</span> <span class="o">+</span> <span class="n">mod</span><span class="o">.</span><span class="n">boss_pdamage</span><span class="p">,</span>
                <span class="s2">&quot;boss_pdamage&quot;</span> <span class="p">:</span> <span class="n">mod</span><span class="o">.</span><span class="n">boss_pdamage</span><span class="p">,</span>
                <span class="s2">&quot;armor_ignore&quot;</span> <span class="p">:</span> <span class="n">mod</span><span class="o">.</span><span class="n">armor_ignore</span><span class="p">,</span>
                <span class="s2">&quot;pdamage_indep&quot;</span> <span class="p">:</span> <span class="n">mod</span><span class="o">.</span><span class="n">pdamage_indep</span><span class="p">,</span>
                <span class="s2">&quot;effective_status&quot;</span> <span class="p">:</span> <span class="n">mod</span><span class="o">.</span><span class="n">get_status_factor</span><span class="p">(),</span>
                <span class="s2">&quot;crit_damage&quot;</span> <span class="p">:</span> <span class="n">mod</span><span class="o">.</span><span class="n">crit_damage</span><span class="p">,</span>
                <span class="s2">&quot;crit&quot;</span> <span class="p">:</span> <span class="n">mod</span><span class="o">.</span><span class="n">crit</span>
        <span class="p">}</span>
                
        <span class="k">return</span> <span class="n">meta</span>
        
    <span class="k">def</span> <span class="nf">statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total damage </span><span class="si">%.1f</span><span class="s2"> in </span><span class="si">%d</span><span class="s2"> second&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_damage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalTime</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">)</span>

        <span class="k">def</span> <span class="nf">getSkillNames</span><span class="p">(</span><span class="n">logList</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sname</span><span class="p">,</span> <span class="n">logList</span><span class="p">)))</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">===Buff Skills===&quot;</span><span class="p">)</span>
        <span class="n">buffList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">spec</span> <span class="o">==</span> <span class="s2">&quot;buff&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logList</span><span class="p">))</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">getSkillNames</span><span class="p">(</span><span class="n">buffList</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">skillLog</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sname</span> <span class="o">==</span> <span class="n">name</span><span class="p">,</span> <span class="n">buffList</span><span class="p">))</span>
            <span class="n">use</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">skillLog</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{name}</span><span class="s2"> Used </span><span class="si">{use}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">shareDict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">===Damage Skills===&quot;</span><span class="p">)</span>
        <span class="n">damageList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">spec</span> <span class="o">==</span> <span class="s2">&quot;damage&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logList</span><span class="p">))</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">getSkillNames</span><span class="p">(</span><span class="n">damageList</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">skillLog</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sname</span> <span class="o">==</span> <span class="n">name</span><span class="p">,</span> <span class="n">damageList</span><span class="p">))</span>
            <span class="n">use</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">skillLog</span><span class="p">)</span>
            <span class="n">hit</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">hit</span><span class="p">,</span> <span class="n">skillLog</span><span class="p">))</span>
            <span class="n">damage</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="p">[</span><span class="s2">&quot;deal&quot;</span><span class="p">],</span> <span class="n">skillLog</span><span class="p">))</span>
            <span class="n">share</span> <span class="o">=</span> <span class="n">damage</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_damage</span> <span class="o">*</span> <span class="mi">100</span>
            <span class="n">shareDict</span><span class="p">[</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">share</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{name}</span><span class="s2"> Used </span><span class="si">{use}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Hit </span><span class="si">{hit}</span><span class="s2"> Damage </span><span class="si">{damage}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Share </span><span class="si">{share:.4f}</span><span class="s2">%&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">===Summon/DoT Skills===&quot;</span><span class="p">)</span>
        <span class="n">summonList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">spec</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;summon&quot;</span><span class="p">,</span> <span class="s2">&quot;dot&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">logList</span><span class="p">))</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">getSkillNames</span><span class="p">(</span><span class="n">summonList</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">skillLog</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sname</span> <span class="o">==</span> <span class="n">name</span><span class="p">,</span> <span class="n">summonList</span><span class="p">))</span>
            <span class="n">summon</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="p">[</span><span class="s2">&quot;deal&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">skillLog</span><span class="p">)))</span>
            <span class="n">use</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">skillLog</span><span class="p">)</span> <span class="o">-</span> <span class="n">summon</span>
            <span class="n">hit</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">hit</span><span class="p">,</span> <span class="n">skillLog</span><span class="p">))</span>
            <span class="n">damage</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="p">[</span><span class="s2">&quot;deal&quot;</span><span class="p">],</span> <span class="n">skillLog</span><span class="p">))</span>
            <span class="n">share</span> <span class="o">=</span> <span class="n">damage</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_damage</span> <span class="o">*</span> <span class="mi">100</span>
            <span class="n">shareDict</span><span class="p">[</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">share</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{name}</span><span class="s2"> Summoned </span><span class="si">{summon}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Used </span><span class="si">{use}</span><span class="s2"> Hit </span><span class="si">{hit}</span><span class="s2"> Damage </span><span class="si">{damage}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Share </span><span class="si">{share:.4f}</span><span class="s2">%&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">===Skill Share===&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">share</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">shareDict</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">share</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{name}</span><span class="s2">, </span><span class="si">{share:.4f}</span><span class="s2">%&quot;</span><span class="p">)</span>

        <span class="c1">#self.log(&quot;Percent damage per second is %.2f&quot; % (100*self.total_damage / self.character.get_modifier().get_damage_factor() / self.totalTimeInitial * 1000))</span>

    <span class="k">def</span> <span class="nf">skill_share</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">damageDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">log</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">log</span><span class="p">[</span><span class="s2">&quot;deal&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">log</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">damageDict</span><span class="p">:</span>
                    <span class="n">damageDict</span><span class="p">[</span><span class="n">log</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sname</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">damageDict</span><span class="p">[</span><span class="n">log</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sname</span><span class="p">]</span> <span class="o">+=</span> <span class="n">log</span><span class="p">[</span><span class="s2">&quot;deal&quot;</span><span class="p">]</span>
            
        <span class="k">return</span> <span class="n">damageDict</span>

        
    <span class="k">def</span> <span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">retli</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">log</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logList</span><span class="p">:</span>
            <span class="n">retli</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;time&quot;</span> <span class="p">:</span> <span class="n">log</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> 
                        <span class="s2">&quot;sname&quot;</span> <span class="p">:</span> <span class="n">log</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sname</span><span class="p">,</span> 
                        <span class="s2">&quot;deal&quot;</span> <span class="p">:</span> <span class="n">log</span><span class="p">[</span><span class="s2">&quot;deal&quot;</span><span class="p">],</span> 
                        <span class="s2">&quot;spec&quot;</span> <span class="p">:</span> <span class="n">log</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> 
                        <span class="s2">&quot;else&quot;</span> <span class="p">:</span> <span class="n">log</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">kwargs</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">retli</span>
    
    <span class="k">def</span> <span class="nf">analyzeVEfficiency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;V Core 각각의 효율을 계산합니다!</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="n">damage_list_v_skill</span> <span class="o">=</span> <span class="p">[]</span>    <span class="c1">#5차 스킬의 데미지를 저장합니다.</span>
        <span class="n">damage_list_enhanced_skill</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#강화 스킬의 데미지를 저장합니다.</span>
        
        <span class="k">return</span>
        
    <span class="k">def</span> <span class="nf">add_damage_from_result_with_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">charmdf</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">ResultObject</span><span class="p">):</span>
        <span class="n">mdf</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">damage</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">mdf</span> <span class="o">=</span> <span class="n">charmdf</span> <span class="o">+</span> <span class="n">result</span><span class="o">.</span><span class="n">mdf</span>
            
            <span class="n">deal</span><span class="p">,</span> <span class="n">loss</span> <span class="o">=</span> <span class="n">mdf</span><span class="o">.</span><span class="n">calculate_damage</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">damage</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">hit</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">spec</span><span class="p">)</span>
            <span class="n">free_deal</span> <span class="o">=</span> <span class="n">deal</span> <span class="o">+</span> <span class="n">loss</span>
            
            <span class="c1">#free_deal = mdf.get_damage_factor() * result.damage * 0.01</span>
            <span class="c1">#deal = min(result.hit * MAX_DAMAGE_RESTRICTION, free_deal)</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">deal</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">free_deal</span> <span class="o">=</span> <span class="mi">0</span>
            
        <span class="k">if</span> <span class="n">deal</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">total_damage</span> <span class="o">+=</span> <span class="n">deal</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">total_damage_without_restriction</span> <span class="o">+=</span> <span class="n">free_deal</span>
        
        
        <span class="c1">#For speed acceleration</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_calculation_progress</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;At Time </span><span class="si">%.1f</span><span class="s1">, Skill [</span><span class="si">%s</span><span class="s1">] ... Damage [</span><span class="si">%.1f</span><span class="s1">] ... Loss [</span><span class="si">%.1f</span><span class="s1">] ... Delay [</span><span class="si">%.1f</span><span class="s1">] ... Spec [</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">sname</span><span class="p">,</span> <span class="n">deal</span><span class="p">,</span> <span class="n">free_deal</span> <span class="o">-</span> <span class="n">deal</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">delay</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">spec</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{result.mdf}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">deal</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logList</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;result&quot;</span><span class="p">:</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span> <span class="p">:</span> <span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">time</span><span class="p">),</span> <span class="s2">&quot;deal&quot;</span> <span class="p">:</span> <span class="n">deal</span><span class="p">,</span> <span class="s2">&quot;loss&quot;</span> <span class="p">:</span> <span class="n">free_deal</span> <span class="o">-</span> <span class="n">deal</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logList</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;result&quot;</span><span class="p">:</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span> <span class="p">:</span> <span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">time</span><span class="p">),</span> <span class="s2">&quot;deal&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;loss&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">sname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skillList</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skillList</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">sname</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            
    <span class="k">def</span> <span class="nf">deduce_increment_of_temporal_modifier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">continue_time_length</span><span class="p">,</span> <span class="n">temporal_modifier</span><span class="p">,</span>
                                            <span class="n">search_time_scan_rate</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">):</span>
        
        <span class="k">def</span> <span class="nf">search_time_index</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">hoping_rate_init</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
            <span class="n">hoping_rate</span> <span class="o">=</span> <span class="n">hoping_rate_init</span>
            <span class="n">time_index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">time_index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logList</span><span class="p">):</span>
                    <span class="n">time_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logList</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="k">break</span>                
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logList</span><span class="p">[</span><span class="n">time_index</span><span class="p">][</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">time</span><span class="p">:</span>
                    <span class="n">time_index</span> <span class="o">+=</span> <span class="n">hoping_rate</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logList</span><span class="p">[</span><span class="n">time_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">time</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">hoping_rate</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">hoping_rate</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
                        <span class="n">time_index</span> <span class="o">-=</span> <span class="n">hoping_rate</span>
                        <span class="n">time_index</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">time_index</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">time_index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">return</span> <span class="mi">0</span>
                        
            <span class="k">return</span> <span class="n">time_index</span>
        
        <span class="k">def</span> <span class="nf">get_damage_sum_in_time_interval</span><span class="p">(</span><span class="n">time_start</span><span class="p">,</span> <span class="n">time_length</span><span class="p">):</span>
            <span class="n">damage_sum</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">time_log_index</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">search_time_index</span><span class="p">(</span><span class="n">time_start</span><span class="p">))</span>
            <span class="c1">#print(&quot;start_time_index&quot;, time_log_index, time_start)</span>
                
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">logList</span><span class="p">[</span><span class="n">time_log_index</span><span class="p">][</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">time_start</span> <span class="o">+</span> <span class="n">time_length</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">logList</span><span class="p">[</span><span class="n">time_log_index</span><span class="p">][</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">time_start</span><span class="p">:</span>
                <span class="n">damage_sum</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logList</span><span class="p">[</span><span class="n">time_log_index</span><span class="p">][</span><span class="s2">&quot;deal&quot;</span><span class="p">]</span>
                <span class="n">time_log_index</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">time_log_index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logList</span><span class="p">):</span>
                    <span class="k">break</span>
            
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">time_log_index</span><span class="p">,</span> <span class="n">time_log_index</span> <span class="o">+</span> <span class="mi">20</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logList</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logList</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">time_start</span> <span class="o">+</span> <span class="n">time_length</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">logList</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">time_start</span><span class="p">:</span>
                        <span class="n">damage_sum</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logList</span><span class="p">[</span><span class="n">time_log_index</span><span class="p">][</span><span class="s2">&quot;deal&quot;</span><span class="p">]</span> 
            
            <span class="c1">#print(&quot;end_time_index&quot;, time_log_index)</span>
            
            <span class="c1">#print(&quot;log&quot;,time_start, time_length, damage_sum)</span>
            <span class="k">return</span> <span class="n">damage_sum</span>
        
        <span class="c1"># search_time_scan_rate : 기록되어 있는 로그를 스캔할 시간주기입니다. 기본값 : 1000(ms)</span>
        
        <span class="c1"># scanning algorithm</span>
        <span class="n">maximal_time_loc</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">damage_log_queue</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_damage_sum_in_time_interval</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">search_time_scan_rate</span><span class="p">,</span> <span class="n">search_time_scan_rate</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">continue_time_length</span> <span class="o">//</span> <span class="n">search_time_scan_rate</span><span class="p">)]</span>
        <span class="n">maximal_damage</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">damage_log_queue</span><span class="p">)</span>
        
        <span class="n">scanning_end_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">continue_time_length</span> <span class="o">//</span> <span class="n">search_time_scan_rate</span><span class="p">)</span><span class="o">*</span><span class="n">search_time_scan_rate</span>
        
        <span class="k">while</span> <span class="n">scanning_end_time</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalTime</span><span class="p">:</span>
            <span class="n">damage_log_queue</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">damage_log_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_damage_sum_in_time_interval</span><span class="p">(</span><span class="n">scanning_end_time</span><span class="p">,</span> <span class="n">search_time_scan_rate</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">damage_log_queue</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">maximal_damage</span><span class="p">:</span>
                <span class="n">maximal_time_loc</span> <span class="o">=</span> <span class="n">scanning_end_time</span> <span class="o">-</span> <span class="n">continue_time_length</span>
                <span class="n">maximal_damage</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">damage_log_queue</span><span class="p">)</span>
            <span class="n">scanning_end_time</span> <span class="o">+=</span> <span class="n">search_time_scan_rate</span>
        
        <span class="c1">#Now we know when damage is maximized. We now apply our modifier into this.</span>
        
        <span class="n">total_damage</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">log</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logList</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">log</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">damage</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">mdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chtrmdf</span> <span class="o">+</span> <span class="n">result</span><span class="o">.</span><span class="n">mdf</span>
                <span class="k">if</span> <span class="n">log</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">maximal_time_loc</span> <span class="ow">and</span> <span class="n">log</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">maximal_time_loc</span> <span class="o">+</span> <span class="n">continue_time_length</span><span class="p">:</span>
                    <span class="n">mdf</span> <span class="o">+=</span> <span class="n">temporal_modifier</span>
                <span class="n">deal</span><span class="p">,</span> <span class="n">loss</span> <span class="o">=</span> <span class="n">mdf</span><span class="o">.</span><span class="n">calculate_damage</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">damage</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">hit</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">spec</span><span class="p">)</span>
                <span class="n">total_damage</span> <span class="o">+=</span> <span class="n">deal</span>
        
        <span class="n">simple_increment</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">chtrmdf</span> <span class="o">+</span> <span class="n">temporal_modifier</span><span class="p">)</span><span class="o">.</span><span class="n">get_damage_factor</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chtrmdf</span><span class="o">.</span><span class="n">get_damage_factor</span><span class="p">())</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">continue_time_length</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalTime</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;damage&quot;</span> <span class="p">:</span> <span class="p">(</span><span class="n">total_damage</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_damage</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">60000</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalTime</span><span class="p">)</span> <span class="p">,</span> <span class="s2">&quot;increment&quot;</span> <span class="p">:</span> <span class="p">(</span><span class="n">total_damage</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_damage</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;simple_increment&quot;</span> <span class="p">:</span> <span class="n">simple_increment</span><span class="p">}</span>



<span class="k">class</span> <span class="nc">BasicVEnhancer</span><span class="p">(</span><span class="n">AbstractVEnhancer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#### value list ####</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enhance_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_skill_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">core_number</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="c1">#### analytics list ####</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enhancer_priority</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># 5차의 강화스킬 순서</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_skill_priority</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># 5차의 사용스킬 순서</span>
    
    <span class="k">def</span> <span class="nf">get_priority</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">v_skill_list_sorted</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)]</span>  <span class="c1">#20 is magic number</span>
        <span class="k">for</span> <span class="n">vskill</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_skill_priority</span><span class="p">:</span>
            <span class="n">v_skill_list_sorted</span><span class="p">[</span><span class="n">vskill</span><span class="p">[</span><span class="s2">&quot;useIdx&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vskill</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;enhance&quot;</span> <span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="n">skills</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]}</span> <span class="k">for</span> <span class="n">skills</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">enhancer_priority</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">skills</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span>
                <span class="s2">&quot;vskill&quot;</span> <span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="n">skills</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;target&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]}</span> <span class="k">for</span> <span class="n">skills</span> <span class="ow">in</span> <span class="n">v_skill_list_sorted</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">skills</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]}</span>
    
    <span class="k">def</span> <span class="nf">set_state_direct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">li</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enhance_list</span> <span class="o">=</span> <span class="n">li</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enhancer_priority</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">li</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">set_vlevel_direct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">li</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_skill_list</span> <span class="o">=</span> <span class="n">li</span>

    <span class="k">def</span> <span class="nf">get_reinforcement_with_register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">incr</span><span class="p">,</span> <span class="n">crit</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enhancer_priority</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">enhance_list</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">CharacterModifier</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">VSkillModifier</span><span class="o">.</span><span class="n">get_reinforcement</span><span class="p">(</span><span class="n">incr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">enhance_list</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">crit</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getV</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_index</span><span class="p">,</span> <span class="n">upgrade_index</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">use_index</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_skill_list</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_skill_list</span><span class="p">[</span><span class="n">upgrade_index</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">add_v_skill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">use_index</span><span class="p">,</span> <span class="n">upgrade_index</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_skill_priority</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;target&quot;</span> <span class="p">:</span> <span class="n">target</span><span class="p">,</span> <span class="s2">&quot;useIdx&quot;</span> <span class="p">:</span> <span class="n">use_index</span><span class="p">,</span> <span class="s2">&quot;upgIdx&quot;</span> <span class="p">:</span> <span class="n">upgrade_index</span><span class="p">})</span>
        
    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">retval</span> <span class="o">=</span> <span class="n">BasicVEnhancer</span><span class="p">()</span>
        <span class="n">retval</span><span class="o">.</span><span class="n">set_state_direct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">enhance_list</span><span class="p">)</span>
        <span class="n">retval</span><span class="o">.</span><span class="n">set_vlevel_direct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_skill_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">retval</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;VEnhancer :: dpmModule.jobs.template</span><span class="se">\n</span><span class="s2">VEnhance : </span><span class="si">%s</span><span class="se">\n</span><span class="s2">VSkill : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">enhance_list</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_skill_list</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">DirectVBuilder</span><span class="p">(</span><span class="n">AbstractVBuilder</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direct_enhance_state</span><span class="p">,</span> <span class="n">direct_v_state</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">direct_enhance_state</span> <span class="o">=</span> <span class="n">direct_enhance_state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">direct_v_state</span> <span class="o">=</span> <span class="n">direct_v_state</span>

    <span class="k">def</span> <span class="nf">build_enhancer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">character</span><span class="p">,</span> <span class="n">generator</span><span class="p">):</span>
        <span class="n">enhancer</span> <span class="o">=</span> <span class="n">BasicVEnhancer</span><span class="p">()</span>
        <span class="n">enhancer</span><span class="o">.</span><span class="n">set_state_direct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">direct_enhance_state</span><span class="p">)</span>
        <span class="n">enhancer</span><span class="o">.</span><span class="n">set_vlevel_direct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">direct_v_state</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">enhancer</span>

<span class="k">class</span> <span class="nc">AlwaysMaximumVBuilder</span><span class="p">(</span><span class="n">AbstractVBuilder</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">build_enhancer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">character</span><span class="p">,</span> <span class="n">generator</span><span class="p">):</span>
        <span class="n">enhancer</span> <span class="o">=</span> <span class="n">BasicVEnhancer</span><span class="p">()</span>
        <span class="n">enhancer</span><span class="o">.</span><span class="n">set_state_direct</span><span class="p">([</span><span class="mi">60</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">)])</span>
        <span class="n">enhancer</span><span class="o">.</span><span class="n">set_vlevel_direct</span><span class="p">([</span><span class="mi">30</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">)])</span>        
        <span class="k">return</span> <span class="n">enhancer</span>

<span class="k">class</span> <span class="nc">NjbStyleVBuilder</span><span class="p">(</span><span class="n">AbstractVBuilder</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skill_core_level</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span> <span class="n">each_enhanced_amount</span> <span class="o">=</span> <span class="mi">17</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skill_core_level</span> <span class="o">=</span> <span class="n">skill_core_level</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">each_enhanced_amount</span> <span class="o">=</span> <span class="n">each_enhanced_amount</span>

    <span class="k">def</span> <span class="nf">build_enhancer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">character</span><span class="p">,</span> <span class="n">generator</span><span class="p">):</span>
        <span class="n">level</span> <span class="o">=</span> <span class="n">character</span><span class="o">.</span><span class="n">level</span>
        <span class="n">cores</span> <span class="o">=</span> <span class="n">generator</span><span class="o">.</span><span class="n">vSkillNum</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_state_from_level_and_skill_cores</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">cores</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill_core_level</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">each_enhanced_amount</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_state_from_level_and_skill_cores</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">skill_cores</span><span class="p">,</span> <span class="n">skill_core_level</span><span class="p">,</span> <span class="n">each_enhanced_amount</span><span class="p">):</span>
        <span class="n">total_core_slots</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">+</span> <span class="p">(</span><span class="n">level</span> <span class="o">-</span> <span class="mi">200</span><span class="p">)</span> <span class="o">//</span> <span class="mi">5</span>
        <span class="n">available_core_slots</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">total_core_slots</span> <span class="o">-</span> <span class="n">skill_cores</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">level_bonus</span> <span class="o">=</span> <span class="n">level</span> <span class="o">-</span> <span class="mi">200</span>
        
        <span class="n">enhance_state_will_be_setted</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">)]</span>
        
        <span class="k">if</span> <span class="n">available_core_slots</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">available_core_slots</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                    <span class="n">enhance_state_will_be_setted</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">17</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">available_core_slots</span><span class="p">):</span>
                <span class="n">enhance_state_will_be_setted</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span>
        
        <span class="k">while</span> <span class="n">level_bonus</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">chance_for_upgrade</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">level_bonus</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
            <span class="n">target_upgrade_skill_index</span> <span class="o">=</span> <span class="mi">0</span>
            
            <span class="n">enhancement_left</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1">#하나의 코어는 3개의 스킬을 강화합니다.</span>
            <span class="k">while</span> <span class="n">target_upgrade_skill_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">enhance_state_will_be_setted</span><span class="p">)</span> <span class="ow">and</span> <span class="n">enhancement_left</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">enhance_state_will_be_setted</span><span class="p">[</span><span class="n">target_upgrade_skill_index</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">60</span> <span class="p">:</span> 
                    <span class="n">maximum_upgrade_level_available</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">-</span> <span class="n">enhance_state_will_be_setted</span><span class="p">[</span><span class="n">target_upgrade_skill_index</span><span class="p">]</span>
                    <span class="n">actual_chance_for_upgrade</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">chance_for_upgrade</span><span class="p">,</span> <span class="n">maximum_upgrade_level_available</span><span class="p">)</span>
                    <span class="n">enhance_state_will_be_setted</span><span class="p">[</span><span class="n">target_upgrade_skill_index</span><span class="p">]</span> <span class="o">+=</span> <span class="n">actual_chance_for_upgrade</span>
                    <span class="n">enhancement_left</span> <span class="o">-=</span> <span class="mi">1</span>
                    
                <span class="n">target_upgrade_skill_index</span> <span class="o">+=</span> <span class="mi">1</span>
                
            <span class="n">level_bonus</span> <span class="o">-=</span> <span class="n">chance_for_upgrade</span>
            
        <span class="n">enhancer</span> <span class="o">=</span> <span class="n">BasicVEnhancer</span><span class="p">()</span>
        <span class="n">enhancer</span><span class="o">.</span><span class="n">set_state_direct</span><span class="p">(</span><span class="n">enhance_state_will_be_setted</span><span class="p">)</span>
        <span class="n">enhancer</span><span class="o">.</span><span class="n">set_vlevel_direct</span><span class="p">(</span> <span class="p">[(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">skill_cores</span><span class="p">)</span> <span class="o">*</span> <span class="n">skill_core_level</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">enhancer</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; 저작권 2020, meson3241@gmail.com

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>